---
layout:     post
title:      é¡¹ç›®æ€»ç»“
subtitle:   
date:       2024-11-15
author:     phoenixZ
header-img: /img/oip3.jpg
catalog: true
tags:
    - boss
---
# èˆªè¿¹é£è¡ŒåŒºåŸŸè¦†ç›–

## åŒºåŸŸè¦†ç›–

æ ¹æ®åŒºåŸŸï¼š åœ†å½¢ã€çŸ©å½¢ å–æœ€å°çš„Xï¼ŒYï¼›

**åœ†å½¢çš„è¯ï¼š**

1. å…ˆæ ¹æ®GPS2XYZï¼Œ  åˆ©ç”¨åœ†å¿ƒå’ŒåŠå¾„å¾—åˆ° Xminï¼Œ Xmaxï¼Œ Yminï¼Œ Ymax
2. æ ¹æ®é—´éš”nç±³ä¸€ä¸ªç‚¹çš„åŸåˆ™ï¼Œä»å·¦ä¸‹åˆ°å·¦ä¸Šï¼ŒSå½¢èµ°ä½ï¼Œå¹¶ä¸”è¦åˆ¤æ–­ç‚¹åœ¨ä¸åœ¨åœ†å½¢å†…(å‹¾è‚¡å®šç†ï¼Œ ç‚¹ä¸åœ†å¿ƒç‚¹çš„å¹³æ–¹è·ç¦»)

**å¤šè¾¹å½¢çš„è¯ï¼š**

1. ç›´æ¥å¯ä»¥å¾—åˆ°Xmin, Ymin
2. æ ¹æ®é—´éš”nç±³ä¸€ä¸ªç‚¹çš„åŸåˆ™ï¼Œåˆ¤æ–­ç”Ÿæˆå¤šå°‘ä¸ªç‚¹

{% highlight cpp %}
void algo_search::generatePoints()
{

    all_point.clear();

    int x_count = (xMax - xMin) / per_distance + 1;

    int y_count = (yMax - yMin) / per_distance + 1;

    all_point.emplace_back(xMin, yMin, mission_get.missions[0].height);

    double y_start = yMin;

    for (int j = 1; j <= y_count; ++j)
    {

    y_start += per_distance;

    all_point.emplace_back(xMin, y_start, mission_get.missions[0].height);
    }

    double x_start = xMin;

    for (int i = 1; i <= x_count; ++i)

    {

    x_start += per_distance;

    all_point.emplace_back(x_start, y_start, mission_get.missions[0].height);

    for (int j = 1; j <= y_count; ++j)
        {

    if ((i % 2) == 1)

    {

    y_start -= per_distance;
            }

    else
            {

    y_start += per_distance;
            }

    all_point.emplace_back(x_start, y_start, mission_get.missions[0].height);
        }
    }
}
{% endhighlight %}

## PID

PID æ˜¯æ¯”ä¾‹-ç§¯åˆ†-å¾®åˆ†æ§åˆ¶

æˆ‘æ˜¯è¿™æ ·ç†è§£çš„ï¼š æƒ³è±¡æœ‰ä¸€æ¡¶æ°´ï¼Œ å½“å‰æ°´é‡0.2L, ç›®æ ‡æ°´é‡1L

**å¯¹äºæ¯”ä¾‹æ§åˆ¶**ï¼š

U = Kp * (ç›®æ ‡å€¼ - å½“å‰å€¼)ï¼Œ å‡è®¾1såŠ ä¸€æ¬¡æ°´ï¼Œ ä¸€æ¬¡åŠ 0.5L

ç¬¬ä¸€å¸§ï¼šU = 0.5 * 0.8 = 0.4,  diff = 1-0.6 = 0.4
ç¬¬äºŒå¸§ï¼šU = 0.5 * 0.4 = 0.2,  diff = 1-0.8 = 0.2
ç¬¬ä¸‰å¸§ï¼šU = 0.5 * 0.2 = 0.1,  diff = 1-0.9 = 0.1
...

ä½†æ˜¯å¦‚æœè€ƒè™‘æ°´ç¼¸ä¼šæ¼æ°´çš„æƒ…å†µï¼Œå°±ä¼šæœ‰ç¨³æ€è¯¯å·®çš„å½¢æˆï¼Œ ä¹Ÿå°±æ˜¯ç¨³å®šåœ¨0.8Lä¸å¾€ä¸Šå¢åŠ äº†

**è¿™æ—¶éœ€è¦å¼•å…¥ç§¯åˆ†æ§åˆ¶**

U = Kp Ã— diff + Ki Ã— ç´¯ç§¯çš„diff

å¢åŠ æ¯æ¬¡çš„è¾“å…¥ï¼Œé˜²æ­¢ç¨³æ€è¯¯å·®

**å¯¹äºå¾®åˆ†æ§åˆ¶**

U = Kp Ã— diff + Ki Ã— ç´¯ç§¯çš„diff + Kp*(diff / dt)

å¾®åˆ†æ§åˆ¶ä¸»è¦æ˜¯é˜²æ­¢éœ‡è¡

{% highlight cpp %}
float PID::computeVal(const float &cur_status, const float &target_status, const float &delta_t)
{
    float val_p, val_i, val_d, error, res_val;

    error = target_status - cur_status;

    val_p = error;

    val_i += error * delta_t;
    val_d = (error - last_error_) / delta_t;

    last_error_ = error;

    //æ¯”ä¾‹æ§åˆ¶ + ç§¯åˆ†æ§åˆ¶ + å¾®åˆ†æ§åˆ¶
    res_val = kp_ * val_p + ki_ * val_i + kd_ * val_d;

    return res_val;
}
{% endhighlight %}

# ç›®æ ‡è·Ÿéšä¸é˜²ä¸¢å¤±ç­–ç•¥

## æ¨¡å‹éƒ¨ç½²

## å¡å°”æ›¼æ»¤æ³¢

å¡å°”æ›¼æ»¤æ³¢å™¨æ˜¯ä¸€ç§ç”¨äº**çº¿æ€§**ç³»ç»ŸçŠ¶æ€ä¼°è®¡çš„é€’å½’ç®—æ³•ã€‚å®ƒé€šè¿‡èåˆå¸¦æœ‰å™ªå£°çš„æµ‹é‡å€¼å’Œä¸€ä¸ªåŒ…å«ç³»ç»ŸåŠ¨æ€çš„é¢„æµ‹æ¨¡å‹ï¼Œæ¥äº§ç”Ÿå¯¹ç³»ç»ŸçŠ¶æ€çš„æœ€ä¼˜ä¼°è®¡ã€‚è¿™é‡Œçš„â€œæœ€ä¼˜â€æ˜¯æŒ‡åœ¨æœ€å°å‡æ–¹è¯¯å·® (Minimum Mean Square Error, MMSE) æ„ä¹‰ä¸‹ã€‚

### æ ¸å¿ƒå‡è®¾

1. **ç³»ç»Ÿæ˜¯çº¿æ€§çš„ã€‚**
2. **è¿‡ç¨‹å™ªå£°å’Œæµ‹é‡å™ªå£°æ˜¯é›¶å‡å€¼ã€é«˜æ–¯åˆ†å¸ƒï¼ˆæ­£æ€åˆ†å¸ƒï¼‰çš„ç™½å™ªå£°ã€‚**

### 1. ç³»ç»Ÿæ¨¡å‹ (System Model)

ä¸€ä¸ªç¦»æ•£æ—¶é—´çº¿æ€§ç³»ç»Ÿå¯ä»¥è¡¨ç¤ºä¸ºï¼š

* çŠ¶æ€è½¬ç§»æ–¹ç¨‹ (Prediction):
  $$
  x_k = F_{k-1} x_{k-1} + B_{k-1} u_{k-1} + w_{k-1}
  $$
* æµ‹é‡æ–¹ç¨‹ (Update):
  $$
  z_k = H_k x_k + v_k
  $$

| **ç¬¦å·**        | **æè¿°**                                                                           |
| --------------------- | ---------------------------------------------------------------------------------------- |
| **$x_k$**     | **$k$**æ—¶åˆ»çš„**ç³»ç»ŸçŠ¶æ€å‘é‡**                                              |
| **$x_{k-1}$** | **$k-1$**æ—¶åˆ»çš„ç³»ç»ŸçŠ¶æ€å‘é‡                                                            |
| **$F_{k-1}$** | **çŠ¶æ€è½¬ç§»çŸ©é˜µ**(æˆ– **ç³»ç»ŸçŸ©é˜µ** )ï¼Œå°†**$x_{k-1}$**æ˜ å°„åˆ°**$x_k$** |
| **$u_{k-1}$** | **$k-1$**æ—¶åˆ»çš„**æ§åˆ¶è¾“å…¥å‘é‡**                                            |
| **$B_{k-1}$** | **æ§åˆ¶è¾“å…¥çŸ©é˜µ**(æˆ– **æ§åˆ¶çŸ©é˜µ** )ï¼Œå°†**$u_{k-1}$**æ˜ å°„åˆ°**$x_k$** |
| **$w_{k-1}$** | **è¿‡ç¨‹å™ªå£°å‘é‡** ï¼Œå‡è®¾**$w_{k-1} \sim N(0, Q_{k-1})$**                          |
| **$Q_{k-1}$** | **è¿‡ç¨‹å™ªå£°åæ–¹å·®çŸ©é˜µ**                                                             |
| **$z_k$**     | **$k$**æ—¶åˆ»çš„**æµ‹é‡å‘é‡**                                                  |
| **$H_k$**     | **è§‚æµ‹çŸ©é˜µ**(æˆ– **æµ‹é‡çŸ©é˜µ** )ï¼Œå°†**$x_k$**æ˜ å°„åˆ°**$z_k$**         |
| **$v_k$**     | **æµ‹é‡å™ªå£°å‘é‡** ï¼Œå‡è®¾**$v_k \sim N(0, R_k)$**                                  |
| **$R_k$**     | **æµ‹é‡å™ªå£°åæ–¹å·®çŸ©é˜µ**                                                             |

### 2. æ ¸å¿ƒå…¬å¼ (Recursive Steps)

KF åŒ…å«ä¸¤ä¸ªé˜¶æ®µï¼š**é¢„æµ‹ (Prediction)** å’Œ  **æ›´æ–° (Update)** ã€‚

#### A. é¢„æµ‹é˜¶æ®µ (Time Update)

åˆ©ç”¨ç³»ç»Ÿçš„åŠ¨æ€æ¨¡å‹æ¥é¢„æµ‹ä¸‹ä¸€æ—¶åˆ»çš„çŠ¶æ€å’Œè¯¯å·®åæ–¹å·®ã€‚

1. å…ˆéªŒçŠ¶æ€ä¼°è®¡ (Predicted State Estimate):
   $$
   \hat{x}_k^- = F_{k-1} \hat{x}_{k-1}^+ + B_{k-1} u_{k-1}
   $$
2. å…ˆéªŒè¯¯å·®åæ–¹å·® (Predicted Covariance Estimate):
   $$
   P_k^- = F_{k-1} P_{k-1}^+ F_{k-1}^T + Q_{k-1}
   $$

| **ç¬¦å·**                | **æè¿°**                                                              |
| ----------------------------- | --------------------------------------------------------------------------- |
| **$\hat{x}_k^-$**     | **$k$**æ—¶åˆ»çš„**å…ˆéªŒ**çŠ¶æ€ä¼°è®¡ (æœªç»“åˆ**$z_k$**æµ‹é‡å€¼)       |
| **$\hat{x}_{k-1}^+$** | **$k-1$**æ—¶åˆ»çš„**åéªŒ**çŠ¶æ€ä¼°è®¡ (å·²ç»“åˆ**$z_{k-1}$**æµ‹é‡å€¼) |
| **$P_k^-$**           | **$k$**æ—¶åˆ»çš„**å…ˆéªŒ**è¯¯å·®åæ–¹å·®çŸ©é˜µ                           |
| **$P_{k-1}^+$**       | **$k-1$**æ—¶åˆ»çš„**åéªŒ**è¯¯å·®åæ–¹å·®çŸ©é˜µ                         |

#### B. æ›´æ–°é˜¶æ®µ (Measurement Update)

åˆ©ç”¨å½“å‰æ—¶åˆ»çš„æµ‹é‡å€¼ **$z_k$** æ¥ä¿®æ­£å…ˆéªŒä¼°è®¡ï¼Œå¾—åˆ°æ›´å‡†ç¡®çš„åéªŒä¼°è®¡ã€‚

1. å¡å°”æ›¼å¢ç›Š (Kalman Gain):
   $$
   K_k = P_k^- H_k^T (H_k P_k^- H_k^T + R_k)^{-1}
   $$
2. åéªŒçŠ¶æ€ä¼°è®¡ (Updated State Estimate):
   $$
   \hat{x}_k^+ = \hat{x}_k^- + K_k (z_k - H_k \hat{x}_k^-)
   $$
3. åéªŒè¯¯å·®åæ–¹å·® (Updated Covariance Estimate):
   $$
   P_k^+ = (I - K_k H_k) P_k^-
   $$

| **ç¬¦å·**            | **æè¿°**                                                        |
| ------------------------- | --------------------------------------------------------------------- |
| **$K_k$**         | **å¡å°”æ›¼å¢ç›ŠçŸ©é˜µ** ï¼Œç”¨äºå¹³è¡¡é¢„æµ‹å’Œæµ‹é‡ä¹‹é—´çš„æƒé‡               |
| **$\hat{x}_k^+$** | **$k$**æ—¶åˆ»çš„**åéªŒ**çŠ¶æ€ä¼°è®¡ (å·²ç»“åˆ**$z_k$**æµ‹é‡å€¼) |
| **$P_k^+$**       | **$k$**æ—¶åˆ»çš„**åéªŒ**è¯¯å·®åæ–¹å·®çŸ©é˜µ                     |
| **$I$**           | é€‚å½“ç»´åº¦çš„**å•ä½çŸ©é˜µ**                                          |

## EKF

å½“ç³»ç»Ÿæ¨¡å‹ï¼ˆçŠ¶æ€è½¬ç§»æ–¹ç¨‹æˆ–æµ‹é‡æ–¹ç¨‹ï¼Œæˆ–ä¸¤è€…ï¼‰æ˜¯**éçº¿æ€§**æ—¶ï¼Œæ ‡å‡†çš„ KF å°±ä¸èƒ½ç›´æ¥ä½¿ç”¨äº†ã€‚EKF æ˜¯ KF é’ˆå¯¹éçº¿æ€§ç³»ç»Ÿçš„ä¸€ç§è¿‘ä¼¼è§£å†³æ–¹æ¡ˆã€‚

### æ ¸å¿ƒæ€æƒ³

EKF çš„æ ¸å¿ƒæ€æƒ³æ˜¯ï¼šåœ¨æ¯æ¬¡çŠ¶æ€é¢„æµ‹å’Œæµ‹é‡æ›´æ–°æ—¶ï¼Œç”¨**ä¸€é˜¶æ³°å‹’çº§æ•°å±•å¼€**æ¥è¿‘ä¼¼éçº¿æ€§ç³»ç»Ÿï¼Œä»è€Œå°†éçº¿æ€§é—®é¢˜ **å±€éƒ¨çº¿æ€§åŒ–** ï¼Œç„¶ååº”ç”¨æ ‡å‡†çš„ KF å…¬å¼ã€‚

### 1. ç³»ç»Ÿæ¨¡å‹ (Nonlinear System Model)

éçº¿æ€§ç¦»æ•£æ—¶é—´ç³»ç»Ÿå¯ä»¥è¡¨ç¤ºä¸ºï¼š

* çŠ¶æ€è½¬ç§»æ–¹ç¨‹ (Prediction):
  $$
  x_k = f(x_{k-1}, u_{k-1}) + w_{k-1}
  $$
* æµ‹é‡æ–¹ç¨‹ (Update):
  $$
  z_k = h(x_k) + v_k
  $$

| **ç¬¦å·**         | **æè¿°**               |
| ---------------------- | ---------------------------- |
| **$f(\cdot)$** | **éçº¿æ€§**çŠ¶æ€è½¬ç§»å‡½æ•° |
| **$h(\cdot)$** | **éçº¿æ€§**æµ‹é‡å‡½æ•°     |

### 2. æ ¸å¿ƒå…¬å¼ (Recursive Steps for EKF)

EKF æœ€å¤§çš„åŒºåˆ«åœ¨äºï¼Œå®ƒç”¨**é›…å¯æ¯”çŸ©é˜µ** (Jacobian Matrix) æ¥ä»£æ›¿ KF ä¸­çš„ **$F$** å’Œ **$H$** çŸ©é˜µã€‚

#### A. é¢„æµ‹é˜¶æ®µ (Time Update)

1. å…ˆéªŒçŠ¶æ€ä¼°è®¡:

   $$
   \hat{x}_k^- = f(\hat{x}_{k-1}^+, u_{k-1})
   $$

   (æ³¨æ„ï¼šè¿™é‡Œç›´æ¥å°†åéªŒçŠ¶æ€ä¼°è®¡ $\hat{x}_{k-1}^+$ ä»£å…¥éçº¿æ€§å‡½æ•° $f$ã€‚)
2. çº¿æ€§åŒ–ï¼šè®¡ç®—çŠ¶æ€è½¬ç§»é›…å¯æ¯”çŸ©é˜µ $F_{k-1}$ï¼Œè¿™æ˜¯ $f(\cdot)$ å…³äºçŠ¶æ€ $x$ çš„åå¯¼æ•°ã€‚

   $$
   F_{k-1} = \left.\frac{\partial f}{\partial x}\right|_{\hat{x}_{k-1}^+, u_{k-1}}
   $$
3. å…ˆéªŒè¯¯å·®åæ–¹å·®:

   $$
   P_k^- = F_{k-1} P_{k-1}^+ F_{k-1}^T + Q_{k-1}
   $$

   (å…¬å¼ç»“æ„ä¸ KF ç›¸åŒï¼Œä½† $F_{k-1}$ æ˜¯é›…å¯æ¯”çŸ©é˜µã€‚)

#### B. æ›´æ–°é˜¶æ®µ (Measurement Update)

1. çº¿æ€§åŒ–ï¼šè®¡ç®—è§‚æµ‹é›…å¯æ¯”çŸ©é˜µ $H_k$ï¼Œè¿™æ˜¯ $h(\cdot)$ å…³äºçŠ¶æ€ $x$ çš„åå¯¼æ•°ã€‚

   $$
   H_k = \left.\frac{\partial h}{\partial x}\right|_{\hat{x}_k^-}
   $$

   (åœ¨é¢„æµ‹çŠ¶æ€ $\hat{x}_k^-$ å¤„è¿›è¡Œçº¿æ€§åŒ–ã€‚)
2. å¡å°”æ›¼å¢ç›Š:

   $$
   K_k = P_k^- H_k^T (H_k P_k^- H_k^T + R_k)^{-1}
   $$

   (å…¬å¼ç»“æ„ä¸ KF ç›¸åŒï¼Œä½† $H_k$ æ˜¯é›…å¯æ¯”çŸ©é˜µã€‚)
3. åéªŒçŠ¶æ€ä¼°è®¡:

   $$
   \hat{x}_k^+ = \hat{x}_k^- + K_k (z_k - h(\hat{x}_k^-))
   $$

   (æ³¨æ„ï¼šè¿™é‡Œçš„æµ‹é‡æ®‹å·®æ˜¯ç”¨å®é™…æµ‹é‡ $z_k$ å‡å»é€šè¿‡éçº¿æ€§å‡½æ•° $h(\cdot)$ å¾—åˆ°çš„é¢„æµ‹æµ‹é‡ã€‚)
4. åéªŒè¯¯å·®åæ–¹å·®:

   $$
   P_k^+ = (I - K_k H_k) P_k^-
   $$

## å•ç›®æµ‹è·

### ç›¸æœºæ¨¡å‹

#### 1. åƒç´ åæ ‡è½¬å›¾åƒåæ ‡

å°†åƒç´ åæ ‡ (u, v) è½¬æ¢ä¸ºå›¾åƒåæ ‡ (x, y) çš„è¿‡ç¨‹å¦‚ä¸‹ï¼š

![åƒç´ ä¸å›¾åƒåæ ‡ç³»ç¤ºæ„å›¾]({{ site.baseurl }}/img/åƒç´ è½¬å›¾åƒ.png)

æ•°å­¦è¡¨è¾¾å¼ä¸ºï¼š

$$
\left\{
\begin{array}{l}
  x = \frac{u - u_0}{d_x} \\[8pt]
  y = \frac{v - v_0}{d_y} \tag{1}
\end{array}
\right.
$$

> è¯´æ˜ï¼š
> UV ä¸ºåƒç´ åæ ‡ç³»ï¼ŒXY ä¸ºå›¾åƒåæ ‡ç³»ã€‚
> oæ˜¯å›¾åƒä¸­å¿ƒ
> (u, v) è¡¨ç¤ºåŸå§‹åƒç´ åæ ‡ï¼Œ(x, y) è¡¨ç¤ºè½¬æ¢åçš„å›¾åƒåæ ‡ï¼›d_x ä¸ d_y åˆ†åˆ«ä¸ºåƒç´ çš„å°ºå¯¸ã€‚

---

#### 2. å›¾åƒåæ ‡è½¬ç›¸æœºåæ ‡

å›¾åƒåæ ‡è½¬æ¢ä¸ºç›¸æœºåæ ‡çš„ç¤ºæ„å¦‚ä¸‹ï¼š

![å›¾åƒåæ ‡è½¬ç›¸æœºåæ ‡]({{ site.baseurl }}/img/å›¾åƒè½¬ç›¸æœº.png)

è½¬æ¢å…¬å¼åŸºäºç›¸ä¼¼ä¸‰è§’å½¢åŸç†ä¸ºï¼š

$$
\left\{
\begin{array}{l}
  x_c = \frac{Z_c \cdot x}{f} \\[8pt]
  y_c = \frac{Z_c \cdot y}{f} \tag{1}
\end{array}
\right.
$$

> è¯´æ˜ï¼š
> â€“ å…¬å¼ä¸­ Z_c è¡¨ç¤ºç›¸æœºä¸ç›®æ ‡ä¹‹é—´çš„è·ç¦»ï¼› åœ¨ç›¸æœºåæ ‡ç³»ä¸­æ˜¯æ²¿ç›¸æœºZè½´çš„è·ç¦»
> â€“ åœ¨å½’ä¸€åŒ–åæ ‡ç³»ä¸‹ï¼Œf çš„å½±å“å¯ä»¥å¿½ç•¥ï¼Œä»è€Œç®€åŒ–è½¬æ¢è¿‡ç¨‹ã€‚

### æµ‹è·ç®—æ³•

![æµ‹è·æ¨¡å‹]({{ site.baseurl }}/img/æµ‹è·æ¨¡å‹.png)

#### 1. è®¡ç®—å…¬å¼

$$
\begin{aligned}
D      &= H \cdot \tan(\alpha - \beta) \quad \text{(1)} \\[8pt]
\alpha &= \frac{\pi}{2} - pitch \quad \text{(2)} \\[8pt]
\beta  &= \arctan(y) \quad \text{(3)}
\end{aligned}
$$

> **è§’åº¦è¯´æ˜ï¼š**
> **$\alpha$**ï¼šç›¸æœºå…‰è½´ä¸æ°´å¹³é¢çš„å¤¹è§’ã€‚å½“äº‘å° pitch è§’å‘ä¸‹å€¾æ–œæ—¶ï¼Œ$\alpha = \frac{\pi}{2} - pitch$ è¡¨ç¤ºä»æ°´å¹³çº¿åˆ°ç›¸æœºå…‰è½´çš„è§’åº¦ã€‚
> **$\beta$**ï¼šä»ç›¸æœºå…‰è½´åˆ°å›¾åƒä¸Šç›®æ ‡æŠ•å½±ç‚¹çš„è§’åº¦ã€‚åœ¨ç›¸æœºåæ ‡ç³»ä¸­ï¼Œè¯¥è§’åº¦ç”±å½’ä¸€åŒ–åçš„å›¾åƒåæ ‡ $y$ è®¡ç®—å¾—åˆ°ï¼Œ$\beta = \arctan(y)$ã€‚
> å› æ­¤ï¼Œ$(\alpha - \beta)$ è¡¨ç¤ºä»æ°´å¹³çº¿åˆ°ç›®æ ‡æŠ•å½±ç‚¹çš„è§’åº¦ï¼Œç”¨äºè®¡ç®—ç›®æ ‡åœ¨æ°´å¹³æ–¹å‘ä¸Šçš„è·ç¦»ã€‚

#### 2. bataè®¡ç®—åŸç†

![Î² å›¾]({{ site.baseurl }}/img/Î².png)

> å›¾ä¸­ï¼š0 è¡¨ç¤ºå…‰å¿ƒï¼Œp ä¸ºå›¾åƒä¸Šçš„æŠ•å½±ç‚¹

ä¸‹é¢è®©æˆ‘è§£é‡Šä¸€ä¸‹ $\beta$ è§’çš„è®¡ç®—åŸç†ï¼š

åœ¨ç›¸æœºæˆåƒåŸç†ä¸­ï¼Œ$\beta$ è§’è¡¨ç¤ºä»ç›¸æœºå…‰å¿ƒæŒ‡å‘å›¾åƒå¹³é¢ä¸ŠæŸæŠ•å½±ç‚¹çš„è§’åº¦ï¼Œè¯¥è§’åº¦å¯ä»¥é€šè¿‡å›¾åƒåæ ‡ $y$ æ¥è®¡ç®—ã€‚

**ä¸ºä»€ä¹ˆ $\beta = \arctan(y)$ï¼Ÿ**åŸå› å¦‚ä¸‹ï¼š

1. å›¾åƒåæ ‡ç³»ä¸­çš„ $y$ å€¼å·²é€šè¿‡ç›¸æœºå†…å‚çŸ©é˜µå½’ä¸€åŒ–å¤„ç†ã€‚
2. å› æ­¤ï¼Œ$\beta$ å°±æ˜¯è¯¥ä¸‰è§’å½¢ä¸­çš„è§’ï¼Œå…¶è®¡ç®—å…¬å¼è‡ªç„¶ä¸º $\arctan(y)$ã€‚

#### 3. è®¡ç®—æ·±åº¦

æ ¹æ®ä¸Šè¿°å…¬å¼ (1)ï¼ŒD è¡¨ç¤º FLU åæ ‡ç³»ä¸­å‘å‰çš„è·ç¦»ï¼ˆå¯¹åº”äº flu_xï¼‰ã€‚

åˆ©ç”¨ flu_x å’Œå‹¾è‚¡å®šç†ï¼Œå¯è¿›ä¸€æ­¥è®¡ç®—æ·±åº¦ï¼ˆå®é™…è·ç¦»ï¼‰ï¼š

$$
depth = \sqrt{flu_x^2 + H^2}.
$$

#### 4. è®¡ç®— yaw è§’

![yaw å›¾]({{ site.baseurl }}/img/yaw.png)

> æ­£ç¡®çš„ yaw è§’åº”ä¸ºç»¿è‰²è™šçº¿ä¸ Zc çš„å¤¹è§’, å³æ˜¯ç›¸æœºåæ ‡ç³»ä¸‹çœŸå®ç›®æ ‡ä¸å…‰å¿ƒçš„å¤¹è§’

$$
\begin{aligned}
yaw &= \arctan\left(\frac{flu_y}{flu_x}\right) \\[8pt]
    &= \arctan\left(\frac{y \cdot dist}{flu_x}\right).
\end{aligned}
$$

#### æ€»ç»“

1. åˆ©ç”¨å‡ ä½•å…³ç³»è§£ç®—ä½ç½® FLU_x = H * tan(äº‘å°å‘ä¸‹çš„è§’åº¦ + æ¥åœ°ç‚¹åœ¨å›¾åƒå¹³é¢æŠ•å½±ç‚¹ä¸ç›¸æœºå…‰è½´çš„å¤¹è§’)
2. æ¥åœ°ç‚¹åœ¨å›¾åƒå¹³é¢æŠ•å½±ç‚¹ä¸ç›¸æœºå…‰è½´çš„å¤¹è§’å¯ä»¥ç”¨ atan(y) è®¡ç®—å¾—åˆ° (pitch)
3. ç„¶åè®¡ç®—æ·±åº¦ï¼Œ æ ¹æ®å‹¾è‚¡å®šç†ï¼Œ depth = H å¹³æ–¹ + FLU_xçš„å¹³æ–¹ç„¶åå¼€æ–¹
4. è®¡ç®—ç›¸æœºåæ ‡ç³»ä¸‹ï¼Œ ç›®æ ‡ç‚¹ä¸ç›¸æœºå…‰è½´çš„å¤¹è§’(yaw)
5. ç„¶ååˆ©ç”¨å›¾åƒåæ ‡è½¬ä¸–ç•Œåæ ‡è®¡ç®—FLU_yï¼Œ ç”¨å›¾åƒç‚¹Xæ¥è½¬æ¢ï¼Œå› ä¸ºxè¡¨ç¤ºç›®æ ‡ç‚¹åœ¨å›¾åƒå¹³é¢åç¦»å…‰è½´çš„å·¦å³ç¨‹åº¦;
6. äº‘å°æ§åˆ¶ä¹Ÿåˆ©ç”¨pitchå’Œyawå°†ç›®æ ‡ä¿æŒåœ¨ç”»é¢ä¸­å¿ƒ

## é˜²ä¸¢å¤±ç­–ç•¥

1. è·Ÿéšè¿‡ç¨‹ä¸­å¾€å‰èµ°ä¸€æ®µè·ç¦»
2. ä»¥è·Ÿéšè·ç¦»ä¸ºåŠå¾„ï¼Œä¸¢å¤±å‰çš„ç›®æ ‡ç‚¹ä¸ºåœ†å½¢è¿›è¡Œç¯ç»•æœç´¢
3. å¦‚æœç®—å‡ºæ¥çš„pitchå’Œyawæ¥è¿‘äº†é˜ˆå€¼å°±é€‚å½“æŠ¬é«˜ã€é™ä½æ— äººæœº

{% highlight cpp %}

void Follow::geratePoints()
{
    circle_angles_.clear();
    float start_angle = atan2(cur_pos_.y - target_pos_.y, cur_pos_.x - target_pos_.x) * (180.0f / M_PI);
    for (int i = 0; i < 360 / std::abs(circle_spd_); ++i) {
        circle_angles_.emplace_back((start_angle + i * circle_spd_) * (M_PI / 180.0f));
    }
    std::reverse(circle_angles_.begin(), circle_angles_.end());
}
{% endhighlight %}

# DJI PSDK

## DJI Eport æ›¿æ¢æ–¹æ¡ˆ

1. ä½¿ç”¨orin NX ä½œè´Ÿè½½çš„æ—¶å€™ï¼Œ ä¸ç”¨é…ç½®USB BULK, é€‰æ‹©ç¡¬ä»¶è¿æ¥æ–¹å¼DJI_USE_UART_AND_NETWORK_DEVICE
2. ä½¿ç”¨rk3588s ä½œä¸ºè´Ÿè½½æ—¶ï¼Œä¸å‚ç…§å®˜æ–¹å»ºè®®é…ç½®rndisï¼Œ ç›´æ¥ä½¿ç”¨ç½‘å¡

   - ä½¿ç”¨lsusb è·å–ç½‘å¡å¯¹åº”çš„VIDå’ŒPID
   - è·å–3588å¯¹åº”ç½‘å£çš„åç§°ï¼Œ ä¿®æ”¹é…ç½®æ–‡ä»¶å¯¹åº”é…ç½®
   - æ£€æŸ¥ä¸²å£åç§°ï¼Œeg. `/dev/ttyUSB0`    å¯¹åº”ä¿®æ”¹hal_uart.hä¸­çš„ `LINUX_UART_DEV1`

## åŒè·¯æ‹‰æµ

1. SDKæ¨¡å—åˆå§‹åŒ–ï¼Œ `DjiCameraManager_Init()` å’Œ `DjiLiveview_Init()`
2. `DjiPayloadCamera_GetVideoStreamRemoteAddress(ipAddr, &port);`ï¼šè·å– DJI è´Ÿè½½ç›¸æœºè§†é¢‘æµçš„è¿œç¨‹ IP åœ°å€å’Œç«¯å£å·
3. å¯è§å…‰ã€çº¢å¤–åŒæ­¥æ‹‰æµ

   - å¯åŠ¨æ‹‰æµï¼Œ ç„¶åç”¨H.264è§£ç 
   - è®¾è®¡é˜Ÿåˆ—ä¸ºå¸§-æ—¶é—´æˆ³ std::queue<std::pair<cv::Mat, int64_t>>
   - æ¯”è¾ƒä¸¤ä¸ªé˜Ÿåˆ—ä¸­æœ€è€å¸§çš„æ—¶é—´æˆ³ï¼Œä¸¢å¼ƒæ—¶é—´æˆ³è¾ƒè€çš„å¸§ï¼Œç›´åˆ°ä¸¤ä¸ªé˜Ÿåˆ—çš„æœ€è€å¸§çš„æ—¶é—´æˆ³è¿‘ä¼¼ç›¸ç­‰(è¯¯å·®å‡ ms)

   {% highlight cpp %}

   DjiLiveview_StartH264Stream(DJI_LIVEVIEW_CAMERA_POSITION_NO_1,
   DJI_LIVEVIEW_CAMERA_SOURCE_DEFAULT,
   &StreamDecoder::startMainCameraDecoding);

   DjiLiveview_StartH264Stream(DJI_LIVEVIEW_CAMERA_POSITION_NO_1,
   DJI_LIVEVIEW_CAMERA_SOURCE_M3T_IR,
   &StreamDecoder::startIrCameraDecoding);

   {% endhighlight %}

   {% highlight cpp %}

   bool StreamDecoder::getSynchronizedFrames(cv::Mat& mainFrame, cv::Mat& irFrame, int syncToleranceMs)
   {
   std::lock_guard[std::mutex](std::mutex) lock(frameMutex);
   const int tolerance = syncToleranceMs; // å®¹å¿æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰

   // æ£€æŸ¥æ˜¯å¦æœ‰è¶³å¤Ÿçš„å¸§è¿›è¡ŒåŒæ­¥
   while (!mainFrameQueue.empty() && !irFrameQueue.empty())
   {
   // è·å–é˜Ÿåˆ—å¤´éƒ¨å¸§çš„æ—¶é—´æˆ³
   int64_t mainTs = mainFrameQueue.front().timestamp;
   int64_t irTs   = irFrameQueue.front().timestamp;

   // **æ³¨æ„**ï¼šPTS çš„å•ä½é€šå¸¸ä¸æ˜¯æ¯«ç§’ã€‚
   // ä¾‹å¦‚ï¼šlong ts_ms = ts * av_q2d(time_base) * 1000;

   long diff = std::abs(mainTs - irTs);

   if (diff <= tolerance)
   {
   // **åŒæ­¥æˆåŠŸ**ï¼šæ—¶é—´æˆ³åŒ¹é…ï¼Œå–å‡ºå¸§å¹¶è¿”å›
   mainFrame = mainFrameQueue.front().frame;
   irFrame   = irFrameQueue.front().frame;

   mainFrameQueue.pop();
   irFrameQueue.pop();

   return true;
   }
   else if (mainTs < irTs)
   {
   std::cout << "Dropping Main Frame. Ts diff: " << diff << "ms." << std::endl;
   mainFrameQueue.pop();
   }
   else // irTs < mainTs
   {
   std::cout << "Dropping IR Frame. Ts diff: " << diff << "ms." << std::endl;
   irFrameQueue.pop();
   }
   }

   // å¦‚æœä»»ä¸€é˜Ÿåˆ—ä¸ºç©ºï¼Œåˆ™æ— æ³•åŒæ­¥
   return false;
   }

   {% endhighlight %}

## è‡ªå®šä¹‰åè®®MOPäº’è”äº’é€š

1. MOPè®¾ç½®
   - PipelineChannelId ä¿¡é“å€¼è®¾ç½®ä¸º38583
   - PipelineDeviceType ä¿¡é“è®¾å¤‡ç±»å‹è®¾ç½®ä¸ºONBOARD
   - TransmissionControlType ä¼ è¾“æ§åˆ¶ç±»å‹ è®¾ç½®ä¸º UNRELIABLE
2. æ™ºèƒ½ç›’å­Mopåè®®ä¸»è¦ç”±ä¸‰éƒ¨åˆ†ç»„æˆï¼šå¸§å¤´ã€å¸§ä½“ï¼ˆè´Ÿè½½ï¼‰ã€å¸§å°¾ï¼ˆæ ¡éªŒï¼‰
3. è¯·æ±‚ä¿¡æ¯ï¼š fusion_module 0ï¼šåŒå…‰ 1. åœ°å›¾ ï¼Œ fusion_commad 0ï¼šåœæ­¢ ï¼Œ 1ï¼š å¼€å§‹ï¼› è¯·æ±‚é‡æ–°å‘é€çš„å›¾åƒå—
4. å‘é€ä¿¡æ¯ï¼š ack_type 0ï¼š çŠ¶æ€ï¼Œ 1ï¼š å›¾åƒï¼Œ data
   - fusion_result_type ï¼šint8_t  è¡¨ç¤ºæ˜¯ä»€ä¹ˆä»»åŠ¡çš„
   - img_uuidï¼šchar è¡¨ç¤ºå›¾åƒå”¯ä¸€æ€§
   - seg_numsï¼šuint16_t  å›¾åƒåˆ†æ®µæ•°ç›®
   - seg_current_numï¼šuint16_t å½“å‰åˆ†æ®µæ•°
   - seg_img_dataï¼šint8_t å½“å‰åˆ†æ®µå›¾åƒå†…å®¹
5. è§£å†³ä¸¢åŒ…ï¼š
   - é€‰æ‹©æ€§é‡ä¼ 
   - è¶…æ—¶æœªæ”¶åˆ°ACKè‡ªåŠ¨é‡ä¼ 
   - è§„å®šæœ€å¤§é‡ä¼ æ•°å’Œæœ€å¤§ç­‰å¾…æ—¶é—´ï¼Œä¸è¡Œæ”¾å¼ƒå½“å‰å¸§
   - å›¾åƒå‹ç¼©æˆJPGæ ¼å¼å‹ç¼©æ‰10%ï¼Œ å¯ä»¥è¿›ä¸€æ­¥å‹ç¼©æˆ–è€…ä½¿ç”¨H.264æ¥å‹ç¼©

# å¤šæ— äººè½¦ååŒæœç´¢

## è¾¹ç•Œä¸è§†ç‚¹ç”Ÿæˆ

### è¾¹ç•Œç”Ÿæˆ

1. åˆå¹¶æœ¬è½¦å½“å‰æ¢ç´¢çš„åŒºåŸŸä¸å…¶ä»–è½¦å½¢æˆçš„åŒºåŸŸ
2. å¦‚æœè¾¹ç•Œåœ¨åŒºåŸŸçš„é‡å åŒºåŸŸå¹¶ä¸”å½“å‰è¿™ä¸ªé‡å åŒºåŸŸçš„è¾¹ç•Œä¸æ˜¯è‡ªç”±åŒºåŸŸæˆ–è€…é‚»é˜ˆæ²¡æœ‰æœªçŸ¥åŒºåŸŸï¼Œåˆ™å°†è¾¹ç•Œåˆ é™¤ï¼› åŒæ ·çš„åŸåˆ™æ£€æŸ¥ä¼‘çœ è¾¹ç•Œï¼›
3. æ ¹æ®åˆå¹¶åŒºåŸŸé€‚å½“è†¨èƒ€ï¼Œä½†æ˜¯ä¿è¯åœ¨åœ°å›¾å†…ï¼Œ å¾—åˆ°æ–°çš„æœç´¢åŒºåŸŸ
4. ç”Ÿæˆè¾¹ç•Œç§å­ç‚¹   åŸåˆ™ï¼š æœªè¢«æ ‡è®°ä¸ºè¾¹ç•Œ + æ‰€å¤„çš„ä½ç½®æ˜¯è‡ªç”±åŒºåŸŸ+é‚»é˜ˆæœªçŸ¥
   {% highlight cpp %}
   // è·å– SDF åœ°å›¾çš„æ•´ä½“è¾¹ç•Œæ¡†
   Vector3d box_min, box_max;
   edt_env_->sdf_map_->getBox(box_min, box_max);

   //å®šä¹‰æœç´¢åŒºåŸŸï¼šå°†æ›´æ–°åŒºåŸŸå’Œå¤–éƒ¨å—è¾¹ç•Œæ¡†ç¨å¾®è†¨èƒ€
   vector[Eigen::Vector3d](Eigen::Vector3d) search_mins, search_maxs;
   for (int i = 0; i < mins.size(); ++i)
   {
   search_mins.push_back(mins[i] - Vector3d(1, 1, 0.2));
   search_maxs.push_back(maxs[i] + Vector3d(1, 1, 0.2));

   // é™åˆ¶èŒƒå›´åœ¨sdfmapèŒƒå›´å†…
   for (int k = 0; k < 3; ++k)
   {
   search_mins[i][k] = max(search_mins[i][k], box_min[k]);
   search_maxs[i][k] = min(search_maxs[i][k], box_max[k]);
   }
   }

   // å°†æœç´¢åŒºåŸŸçš„è¾¹ç•Œæ¡†è½¬æ¢ä¸ºä½“ç´ ç´¢å¼•
   vector[Eigen::Vector3i](Eigen::Vector3i) min_ids(mins.size()), max_ids(mins.size());
   for (int i = 0; i < mins.size(); ++i)
   {
   edt_env_->sdf_map_->posToIndex(search_mins[i], min_ids[i]);
   edt_env_->sdf_map_->posToIndex(search_maxs[i], max_ids[i]);
   }

   // åœ¨æœç´¢åŒºåŸŸå†…æ‰«ææ–°çš„è¾¹ç•Œç§å­
   for (int i = 0; i < min_ids.size(); ++i)
   {
   auto min_id = min_ids[i];
   auto max_id = max_ids[i];

   for (int z = min_id(2); z <= max_id(2); ++z)
   for (int x = min_id(0); x <= max_id(0); ++x)
   for (int y = min_id(1); y <= max_id(1); ++y)
   {
   Eigen::Vector3i cur(x, y, z);
   // æ£€æŸ¥æ¡ä»¶ï¼š
   // 1. æœªæ ‡è®°ä¸ºè¾¹ç•Œ (frontier_flag_ == 0)
   // 2. å½“å‰ä½“ç´ æ˜¯å·²çŸ¥çš„ç©ºé—²åŒºåŸŸ (knownfree)
   // 3. é‚»å±…æœ‰æœªçŸ¥åŒºåŸŸ (isNeighborUnknown)

   if (frontier_flag_[toadr(cur)] == 0 && knownfree(cur) && isNeighborUnknown(cur))
   {
   // ä»ç§å­å•å…ƒæ‰©å±•ï¼Œç”Ÿæˆå®Œæ•´çš„è¾¹ç•Œç°‡
   expandFrontier(cur, ugv_pos);
   }
   }
   }
   {% endhighlight %}

5  æ‰©å±•è¾¹ç•Œï¼› åˆ©ç”¨BFSï¼Œ åŸåˆ™ï¼š åœ¨4çš„åŸºç¡€ä¸ŠåŠ äº†ä¸€ä¸ªåœ°å›¾å†…çš„æ£€æŸ¥
   {% highlight cpp %}
    queue[Eigen::Vector3i](Eigen::Vector3i) cell_queue;
    vector[Eigen::Vector3d](Eigen::Vector3d) expanded;
    Vector3d pos;

    edt_env_->sdf_map_->indexToPos(first, pos);
    expanded.push_back(pos);
    cell_queue.push(first);
    frontier_flag_[toadr(first)] = 1;

    // Search frontier cluster based on region growing (distance clustering)
    while (!cell_queue.empty())
    {
        auto cur = cell_queue.front();
        cell_queue.pop();
        auto nbrs = allNeighbors(cur);
        for (auto nbr : nbrs)
        {
            // Qualified cell should be inside bounding box and frontier cell not clustered
            int adr = toadr(nbr);
            if (frontier_flag_[adr] == 1 || !edt_env_->sdf_map_->isInBox(nbr) || !(knownfree(nbr) && isNeighborUnknown(nbr)))
                continue;

    edt_env_->sdf_map_->indexToPos(nbr, pos);

    if (pos[2] < 0.2) continue;

    expanded.push_back(pos);
            cell_queue.push(nbr);
            frontier_flag_[adr] = 1;
        }
    }
   {% endhighlight %}

### è§†ç‚¹ç”Ÿæˆ

1. é‡‡æ ·ä½ç½®ï¼Œä»¥è¾¹ç•Œä¸ºä¸­å¿ƒç‚¹ï¼Œç”»ä¸‰åœˆåŠå¾„å¤§å°ä¸åŒçš„åŒå¿ƒåœ†
2. è®¾ç½®æ¡ä»¶

   - å¿…é¡»åœ¨åœ°å›¾è¾¹ç•Œæ¡†å†…ï¼ˆisInBoxï¼‰
   - ä¸èƒ½åœ¨éšœç¢ç‰©è†¨èƒ€åŒºåŸŸå†…ï¼ˆgetInflateOccupancy == 1ï¼‰
   - ä¸èƒ½é è¿‘æœªçŸ¥åŒºåŸŸï¼ˆisNearUnknownï¼‰
3. ç”Ÿæˆyaw

   - å»é™é‡‡æ ·åçš„è¾¹ç•Œçš„åœ°ä¸€ä¸ªä½“ç´ ä½œä¸ºå‚è€ƒï¼Œ ä¸é‡‡æ ·è§†ç‚¹ä½œè§’åº¦è®¡ç®—
   - ç„¶åä¾æ¬¡å°†åé¢çš„ä½“ç´ æå–å‡ºæ¥ä¸é‡‡æ ·è§†ç‚¹ä½œè§’åº¦è®¡ç®—å¹¶å–å¹³å‡ï¼Œç„¶åä¸å‚è€ƒè§’åº¦ç´¯åŠ 
   - è¿™æ ·åšçš„ç›®çš„ï¼š **è§†é‡åˆ©ç”¨ç‡æœ€é«˜ï¼Œä¸€æ¬¡èƒ½çœ‹åˆ°æœ€å¤šçš„æœªçŸ¥åŒºåŸŸ**

   {% highlight cpp %}
   void FrontierFinder::sampleViewpoints(Frontier &frontier)
   {
   // åœ¨åœ†å½¢åŒºåŸŸé‡‡æ ·è§†ç‚¹
   // å¤–ç¯æ§åˆ¶é‡‡æ ·åŠå¾„
   for (double rc = candidate_rmin_, dr = (candidate_rmax_ - candidate_rmin_) / candidate_rnum_; rc <= candidate_rmax_ + 1e-3; rc += dr)
   // å†…å¾ªç¯ æ§åˆ¶è§’åº¦ï¼ˆphiï¼‰ï¼Œåœ¨ [-Ï€, Ï€) èŒƒå›´å†…é‡‡æ ·åœ†å‘¨ä¸Šçš„ç‚¹
   for (double phi = -M_PI; phi < M_PI; phi += candidate_dphi_)
   {
   // ä»¥è¾¹ç•Œç°‡å¹³å‡ä½ç½®ä¸ºä¸­å¿ƒï¼Œ ç”»ä¸€åœˆåœˆåŒå¿ƒåœ†
   const Vector3d sample_pos = frontier.average_ + rc * Vector3d(cos(phi), sin(phi), 0);

   // æ£€æŸ¥é‡‡æ ·ç‚¹æ˜¯å¦åˆæ ¼ï¼š
   // 1. å¿…é¡»åœ¨åœ°å›¾è¾¹ç•Œæ¡†å†…ï¼ˆisInBoxï¼‰
   // 2. ä¸èƒ½åœ¨éšœç¢ç‰©è†¨èƒ€åŒºåŸŸå†…ï¼ˆgetInflateOccupancy == 1ï¼‰
   // 3. ä¸èƒ½é è¿‘æœªçŸ¥åŒºåŸŸï¼ˆisNearUnknownï¼‰
   if (!edt_env_->sdf_map_->isInBox(sample_pos) || edt_env_->sdf_map_->getInflateOccupancy(sample_pos) == 1 || isNearUnknown(sample_pos))
   continue;

   //* è®¡ç®—å¹³å‡yawè§’åº¦ */
   auto &cells = frontier.filtered_cells_; //å·²çŸ¥åŒºåŸŸå’ŒæœªçŸ¥åŒºåŸŸçš„è¾¹ç•Œç‚¹ï¼ˆè¿‡æ»¤åï¼‰
   // std::cout << "test filter cell: " << cells.size() << std::endl;
   Eigen::Vector3d ref_dir = (cells.front() - sample_pos).normalized(); // å‚è€ƒæ–¹å‘ï¼šç¬¬ä¸€ä¸ªå•å…ƒåˆ°é‡‡æ ·ç‚¹çš„æ–¹å‘
   double avg_yaw = 0.0;
   for (int i = 1; i < cells.size(); ++i)
   {
   Eigen::Vector3d dir = (cells[i] - sample_pos).normalized();
   double yaw = acos(dir.dot(ref_dir));
   if (ref_dir.cross(dir)[2] < 0)
   yaw = -yaw;
   avg_yaw += yaw;
   }

   avg_yaw = avg_yaw / cells.size() + atan2(ref_dir[1], ref_dir[0]); // è®¡ç®—å¹³å‡åèˆªè§’åº¦ï¼Œ å¹¶åŠ ä¸Šå‚è€ƒæ–¹å‘çš„åˆå§‹è§’åº¦
   wrapYaw(avg_yaw);                                                 // è§„èŒƒåŒ–åˆ° [-Ï€, Ï€]

   // è®¡ç®—ä»è¯¥è§†ç‚¹èƒ½çœ‹åˆ°çš„è¾¹ç•Œå•å…ƒæ•°é‡
   int visib_num = countVisibleCells(sample_pos, avg_yaw, cells);
   if (visib_num > min_visib_num_)
   {
   Viewpoint vp = {sample_pos, avg_yaw, visib_num};
   frontier.viewpoints_.push_back(vp);
   // int gain = findMaxGainYaw(sample_pos, frontier, sample_yaw);
   }
   // }
   }
   }

   {% endhighlight %}

## åŒºåŸŸåˆ†é…ç®—æ³•

## å»ä¸­å¿ƒåŒ–æ–¹æ³•

## è·¯å¾„è§„åˆ’

### å…¨å±€ä¸å±€éƒ¨è§„åˆ’æ–¹æ³•

1. å…¨å±€ï¼š TSPç½‘æ ¼å·¡æ¸¸
2. ä¸­å±‚ï¼š å±€éƒ¨æœ€ä¼˜è§†ç‚¹åºåˆ—
3. å±€éƒ¨ï¼š å‰ç«¯A*ç²—ç•¥æœè·¯ï¼Œ é‡è§„åˆ’ç»™åŠ¨åŠ›å­¦æ¨¡å‹è§„åˆ’ï¼› åç«¯ä¼˜åŒ–ç”¨Bæ ·æ¡æ’å€¼

### å†³å®šå»å“ªä¸ªè¾¹ç•Œçš„å“ªä¸ªè§†ç‚¹

> æ ¹æ®ç½‘æ ¼å’Œè¾¹ç•Œçš„æƒ…å†µæ¥ç”Ÿæˆä¸‹ä¸€ä¸ªæœ€ä½³è§†ç‚¹

1. ç½‘æ ¼ä¸ºç©º

   - æ­¤æ—¶è¦ä¹ˆå…¨å±€è·¯å¾„èµ°å®Œæˆ–è€…è¿˜æ²¡è§„åˆ’å…¨å±€è·¯å¾„
   - éå†æ‰€æœ‰è¾¹ç•Œçš„æœ€ä½³è§†ç‚¹ï¼Œè¿™ä¸ªæœ€ä½³è§†ç‚¹æ ¹æ®èƒ½çœ‹åˆ°æœ€å¤šçš„è¾¹ç•Œä½“ç´ æ’åºçš„
   - é€‰æ•ˆç›Šæœ€å¤§çš„ï¼Œ **è¿™æ ·åšé¿å…æ‘‡æ‘†çš„æƒ…å†µå‘ç”Ÿ**ï¼Œ å¦‚æœç”¨costä¼šå¿½è§†æ‰èƒ½çœ‹åˆ°æ›´å¤šè¾¹ç•Œçš„è§†ç‚¹ï¼Œæ¢ç´¢æ•ˆç‡ä¹Ÿä¼šä½ä¸‹
     {% highlight cpp %}
     auto tmp_cost = ViewNode::computeCost(pos, point, yaw[0], ed_->yaws_[i], vel, yaw[1], tmp_path);
     double tmp_utility = 1.0 / (tmp_cost + 1e-3);

     if (tmp_utility > max_utility)
     {
     max_utility = tmp_utility;
     min_cost_id = i;
     }
     {% endhighlight %}
2. å½“å‰ç½‘æ ¼æ²¡æœ‰å‰æ²¿

   - è¿åŠ¨åˆ°ä¸‹ä¸€ä¸ªç½‘æ ¼ä¸­å¿ƒï¼Œç„¶åå†æ‰¾æœ€è¿‘çš„è¾¹ç•Œè§†ç‚¹
3. å•ä¸€è¾¹ç•Œ

   - ç²¾ç‚¼è§†ç‚¹ï¼ŒæŒ‘é€‰æ’åå‰å‡ çš„è§†ç‚¹
   - å¦‚æœæ­¤æ—¶å·²ç»æ˜¯æœ€åä¸€ä¸ªç½‘æ ¼äº†ï¼Œåˆ™æŒ‘é€‰costæœ€ä½çš„å»
   - å¦‚æœè¿˜æœ‰ç½‘æ ¼ï¼Œå°±æŠŠç½‘æ ¼ä½ç½®åŠ å…¥è§†ç‚¹æ•°ç»„ï¼Œç„¶åç”Ÿæˆå®Œæ•´çš„å·¡æ¸¸è·¯å¾„ï¼Œè¿™æ ·åšå¯ä»¥æ›´å¹³æ»‘
4. å¤šä¸ªå‰æ²¿

   - é€‰å‡ ä¸ªè¾¹ç•Œï¼Œç„¶ååœ¨è¿™å‡ ä¸ªè¾¹ç•Œä¸­æŒ‘é€‰å‡ ä¸ªæ’åé å‰çš„è§†ç‚¹
   - ç„¶åå’Œä¸‰ä¸€æ ·ç”¨å±€éƒ¨å·¡æ¸¸è·¯å¾„ï¼Œ Djikstraæ‰¾è®¿é—®è§†ç‚¹çš„é¡ºåºï¼ŒA*ç”Ÿæˆè·¯å¾„

#### å±€éƒ¨å·¡æ¸¸çš„æ—¶å€™å›¾æ˜¯æ€ä¹ˆå»ºç«‹çš„ï¼Ÿ

æ¯”å¦‚è¯´ï¼Œ

- æœ‰ä¸‰ä¸ªè¾¹ç•Œï¼Œ10ä¸ªè§†ç‚¹ï¼Œ ä¾ç…§åˆ†å±‚å»ºå›¾çš„åŸåˆ™ï¼Œ ç¬¬ä¸€ä¸ªè¾¹ç•Œçš„æ‰€æœ‰è§†ç‚¹åœ¨ç¬¬ä¸€å±‚ï¼Œä½†æ˜¯æ²¡æœ‰è¾¹ç›¸è¿ï¼Œç¬¬ä¸€å±‚çš„èŠ‚ç‚¹è¿æ¥ç¬¬äºŒå±‚çš„æ‰€æœ‰èŠ‚ç‚¹ï¼›
- èŠ‚ç‚¹åŒ…æ‹¬ï¼šè§†ç‚¹ä½ç½®ã€æœ€ä½³æœå‘ï¼Œè¿›å…¥è¯¥è§†ç‚¹çš„é€Ÿåº¦ï¼Œid

{% highlight cpp %}
   for (int i = 0; i < n_points.size(); ++i)
   {
      // Create nodes for viewpoints of one frontier
      for (int j = 0; j < n_points[i].size(); ++j)
      {
         ViewNode::Ptr node(new ViewNode(n_points[i][j], n_yaws[i][j]));
         g_search.addNode(node);
         // Connect a node to nodes in last group
         for (auto nd : last_group)
               g_search.addEdge(nd->id_, node->id_);
         cur_group.push_back(node);

    // Only keep the first viewpoint of the last local frontier
         if (i == n_points.size() - 1)
         {
               final_node = node;
               break;
         }
      }
      // Store nodes for this group for connecting edges
      std::cout << cur_group.size() << ", ";
      last_group = cur_group;
      cur_group.clear();
   }

{% endhighlight %}

#### cost è®¡ç®—

{% highlight cpp %}
   double ViewNode::computeCost(const Vector3d &p1, const Vector3d &p2, const double &y1, const double &y2, const Vector3d &v1, const double &yd1, vector `<Vector3d>` &path)
   {
      // 1. è®¡ç®—ä½ç½®å˜åŒ–ä»£ä»·ï¼Œ /æœ€å¤§é€Ÿåº¦ï¼Œç”¨äºè§„ä¸€åŒ–è·ç¦»æˆæœ¬ä¸ºæ—¶é—´
      double pos_cost = ViewNode::searchPath(p1, p2, path) / vm_;

    // 2. è€ƒè™‘é€Ÿåº¦æ–¹å‘å˜åŒ–çš„ä»£ä»·
      if (v1.norm() > 1e-3)
      {
         Vector3d dir = (p2 - p1).normalized(); //ç›®æ ‡æ–¹å‘
         Vector3d vdir = v1.normalized();       //é€Ÿåº¦æ–¹å‘
         double diff = acos(vdir.dot(dir));     //è®¡ç®—é€Ÿåº¦æ–¹å‘å’Œç›®æ ‡æ–¹å‘çš„å¤¹è§’
         pos_cost += w_dir_ * diff;             // ä¹˜ä¸€ä¸ªæƒé‡ åŠ åˆ°ä½ç½®ä»£ä»·
      }

    // 3. èˆªå‘å˜åŒ–çš„ä»£ä»·
      double diff = fabs(y2 - y1);       // è®¡ç®—èˆªå‘è§’åº¦å·®çš„ç»å¯¹å€¼
      diff = min(diff, 2 * M_PI - diff); // è€ƒè™‘2æ´¾å‘¨æœŸï¼Œ å¾—åˆ°çš„æ˜¯æœ€çŸ­æ—‹è½¬è·¯å¾„
      double yaw_cost = diff / yd_;      // ç”¨å·®å€¼ é™¤ æœ€å¤§èˆªå‘è§’é€Ÿåº¦
      return max(pos_cost, yaw_cost);
   }
{% endhighlight %}

### Djikstra

#### æ ¸å¿ƒæ€æƒ³

**1. åˆå§‹åŒ–ï¼š** ç»´æŠ¤ä¸€ä¸ªé›†åˆï¼Œè®°å½•å·²æ‰¾åˆ°æœ€çŸ­è·¯å¾„çš„èŠ‚ç‚¹ï¼Œä»¥åŠä¸€ä¸ªè·ç¦»æ•°ç»„ï¼Œè®°å½•ä»èµ·ç‚¹åˆ°æ¯ä¸ªèŠ‚ç‚¹çš„å½“å‰æœ€çŸ­è·ç¦»ã€‚èµ·ç‚¹åˆ°è‡ªèº«çš„è·ç¦»è®¾ä¸º 0ï¼Œåˆ°å…¶ä»–æ‰€æœ‰èŠ‚ç‚¹çš„è·ç¦»è®¾ä¸ºæ— ç©·å¤§ï¼ˆ**$\infty$**ï¼‰ã€‚

**2. è¿­ä»£ï¼š** é‡å¤ä»¥ä¸‹æ­¥éª¤ï¼Œç›´åˆ°æ‰€æœ‰èŠ‚ç‚¹éƒ½è¢«è®¿é—®æˆ–ç›®æ ‡èŠ‚ç‚¹è¢«è®¿é—®ï¼š

* ä»**å°šæœªç¡®å®šæœ€çŸ­è·¯å¾„çš„èŠ‚ç‚¹**ä¸­ï¼Œé€‰æ‹©ä¸€ä¸ª**å½“å‰è·ç¦»èµ·ç‚¹æœ€è¿‘**çš„èŠ‚ç‚¹ **$u$**ã€‚
* å°†èŠ‚ç‚¹ **$u$** æ ‡è®°ä¸ºâ€œå·²ç¡®å®šæœ€çŸ­è·¯å¾„â€ã€‚
* æ¾å¼›æ“ä½œ (Relaxation)ï¼š éå† $u$ çš„æ‰€æœ‰é‚»æ¥ç‚¹ $v$ã€‚å¦‚æœé€šè¿‡ $u$ åˆ°è¾¾ $v$ çš„è·ç¦»æ›´çŸ­ï¼Œåˆ™æ›´æ–° $v$ çš„æœ€çŸ­è·ç¦»ã€‚
  $$
  \text{dist}[v] = \min(\text{dist}[v], \text{dist}[u] + \text{weight}(u, v))
  $$
* ä¸ºäº†è®°å½•è·¯å¾„ï¼Œé€šå¸¸è¿˜éœ€è¦ä¸€ä¸ª**å‰é©±ï¼ˆ`parent`ï¼‰æ•°ç»„**æ¥è®°å½•åˆ°è¾¾ **$v$** çš„æœ€çŸ­è·¯å¾„ä¸Šçš„å‰ä¸€ä¸ªèŠ‚ç‚¹ã€‚

#### ç®—æ³•åŸç†

##### åˆå§‹åŒ–

1. è·ç¦»æ•°ç»„ **$\text{dist}[]$**ï¼Œåˆå§‹åŒ– **$\text{dist}[\text{start}] = 0$**ï¼Œå…¶ä½™ä¸º **$\infty$**
2. å‰é©±æ•°ç»„ **$\text{parent}[]$**ï¼Œç”¨äºè·¯å¾„é‡å»º, ä¿å­˜çš„æ˜¯ä¸Šä¸€ä¸ªèŠ‚ç‚¹
3. ä¼˜å…ˆé˜Ÿåˆ— **$PQ$**ï¼Œå­˜å‚¨ **$\langle \text{è·ç¦»}, \text{èŠ‚ç‚¹ID} \rangle$**ï¼Œåˆå§‹å°† **$\langle 0, \text{start} \rangle$** å‹å…¥

##### å¾ªç¯

* ä» **$PQ$** ä¸­å–å‡ºè·ç¦»æœ€å°çš„èŠ‚ç‚¹ **$u$**ï¼ˆåŠå…¶è·ç¦» **$d$**ï¼‰ã€‚
* **å‰ªæ/ä¼˜åŒ–** ï¼šå¦‚æœ **$d > \text{dist}[u]$**ï¼Œè¯´æ˜ **$u$** å·²ç»è¢«æ›´çŸ­çš„è·¯å¾„æ›´æ–°è¿‡ï¼Œè·³è¿‡æœ¬æ¬¡å¾ªç¯ã€‚
* **æ¾å¼›** ï¼šå¯¹äº **$u$** çš„æ¯ä¸ªé‚»å±… **$v$**ï¼ˆè¾¹æƒä¸º **$w$**ï¼‰ï¼š
* å¦‚æœ **$\text{dist}[u] + w < \text{dist}[v]$**ï¼š
  * æ›´æ–° **$\text{dist}[v] = \text{dist}[u] + w$**ã€‚
  * è®¾ç½® **$\text{parent}[v] = u$**ã€‚
  * å°† **$\langle \text{dist}[v], v \rangle$** å‹å…¥ **$PQ$**ã€‚

#### å¤æ‚åº¦è®¡ç®—

æ—¶é—´å¤æ‚åº¦ï¼š

| **æ“ä½œ**                        | **æ‰§è¡Œæ¬¡æ•°**                  | **å•æ¬¡è€—æ—¶ï¼ˆä¼˜å…ˆé˜Ÿåˆ—ï¼‰** | **æ€»è€—æ—¶**          |
| ------------------------------------- | ----------------------------------- | ------------------------------ | ------------------------- |
| **å–å‡ºæœ€å°å…ƒç´  (`pq.pop()`)** | **$V$**æ¬¡ï¼ˆæ¯ä¸ªèŠ‚ç‚¹æœ€å¤šå‡ºé˜Ÿä¸€æ¬¡ï¼‰ | **$O(\log V)$**        | **$O(V \log V)$** |
| **æ¾å¼›æ“ä½œ (`pq.push()`)**    | **$E$**æ¬¡ï¼ˆæ¯æ¡è¾¹æœ€å¤šæ£€æŸ¥ä¸€æ¬¡ï¼‰   | **$O(\log V)$**        | **$O(E \log V)$** |

ç©ºé—´å¤æ‚åº¦ï¼š

| **æ•°æ®ç»“æ„**              | **ç©ºé—´å ç”¨**     | **ä½œç”¨**                                                                                                       |
| ------------------------------- | ---------------------- | -------------------------------------------------------------------------------------------------------------------- |
| **é‚»æ¥è¡¨ (`Graph`)**    | **$O(V + E)$** | å­˜å‚¨å›¾ç»“æ„ï¼ˆ**$V$**ä¸ªèŠ‚ç‚¹åˆ—è¡¨ï¼Œå…±**$E$**æ¡è¾¹è®°å½•ï¼‰ã€‚                                                       |
| **è·ç¦»æ•°ç»„ (`dist`)**   | **$O(V)$**     | å­˜å‚¨ä»èµ·ç‚¹åˆ°æ‰€æœ‰èŠ‚ç‚¹çš„å½“å‰æœ€çŸ­è·ç¦»ã€‚                                                                                 |
| **å‰é©±æ•°ç»„ (`parent`)** | **$O(V)$**     | ç”¨äºè·¯å¾„é‡å»ºã€‚                                                                                                       |
| **ä¼˜å…ˆé˜Ÿåˆ— (`pq`)**     | æœ€å**$O(E)$**       | æœ€åæƒ…å†µä¸‹ï¼Œæ¯æ¡è¾¹æ¾å¼›æ“ä½œéƒ½ä¼šå¯¼è‡´ä¸€ä¸ªå…ƒç´ å…¥é˜Ÿï¼Œè™½ç„¶è®¸å¤šå¯èƒ½æ˜¯é‡å¤çš„ã€‚å®é™…ä¸Šï¼Œåœ¨ä»»ä½•æ—¶åˆ»ï¼Œå…¶å¤§å°é€šå¸¸è¿œå°äº**$E$**. |

#### ä¼˜ç¼ºç‚¹

##### âœ… ä¼˜ç‚¹ (Advantages)

1. **å…¨å±€æœ€ä¼˜è§£** ï¼šèƒ½å¤Ÿä¿è¯æ‰¾åˆ°ä»èµ·ç‚¹åˆ°**æ‰€æœ‰å…¶ä»–å¯è¾¾èŠ‚ç‚¹**çš„ **æœ€çŸ­è·¯å¾„** ï¼Œç»“æœæ˜¯ç»å¯¹å‡†ç¡®çš„ã€‚
2. **æ•ˆç‡é«˜** ï¼šåœ¨è¾¹çš„æƒé‡ä¸ºéè´Ÿæ•°çš„æƒ…å†µä¸‹ï¼Œä¼˜å…ˆé˜Ÿåˆ—ä¼˜åŒ–çš„ Dijkstra ç®—æ³• **$O((V+E)\log V)$** æ•ˆç‡éå¸¸é«˜ï¼Œé€‚ç”¨äºå¤§å‹ç¨€ç–å›¾ã€‚
3. **ç®—æ³•ç®€å•æ¸…æ™°** ï¼šæ ¸å¿ƒæ€æƒ³æ˜¯è´ªå¿ƒç­–ç•¥å’Œæ¾å¼›æ“ä½œï¼Œæ¦‚å¿µç›¸å¯¹å®¹æ˜“ç†è§£å’Œå®ç°ã€‚
4. **åº”ç”¨å¹¿æ³›** ï¼šæ˜¯ GPS å¯¼èˆªã€ç½‘ç»œè·¯ç”±åè®®ï¼ˆå¦‚ OSPFï¼‰ç­‰è®¸å¤šå®é™…åº”ç”¨çš„åŸºç¡€ã€‚

##### âŒ ç¼ºç‚¹ (Disadvantages)

1. **æ— æ³•å¤„ç†è´Ÿæƒè¾¹** ï¼šè¿™æ˜¯ Dijkstra ç®—æ³•æœ€ä¸»è¦çš„é™åˆ¶ã€‚å¦‚æœå›¾ä¸­æœ‰ **è´Ÿæƒè¾¹** ï¼ŒDijkstra ç®—æ³•çš„è´ªå¿ƒç­–ç•¥å°±ä¼šå¤±æ•ˆï¼Œæ— æ³•ä¿è¯æ‰¾åˆ°æœ€çŸ­è·¯å¾„ã€‚

* *æ›¿ä»£æ–¹æ¡ˆï¼š* å¦‚æœå­˜åœ¨è´Ÿæƒè¾¹ï¼Œå¿…é¡»ä½¿ç”¨ **Bellman-Ford ç®—æ³•** (**$O(VE)$**) æˆ–  **SPFA ç®—æ³•** ï¼ˆåœ¨å®é™…åº”ç”¨ä¸­é€šå¸¸å¾ˆå¿«ï¼Œä½†æœ€åæƒ…å†µæ˜¯ **$O(VE)$**ï¼‰ã€‚

1. **å•æºè®¡ç®—** ï¼šå®ƒåªèƒ½è§£å†³**å•æºæœ€çŸ­è·¯å¾„**é—®é¢˜ï¼ˆä»ä¸€ä¸ªèµ·ç‚¹åˆ°æ‰€æœ‰å…¶ä»–ç‚¹ï¼‰ã€‚å¦‚æœéœ€è¦æ‰¾åˆ°æ‰€æœ‰èŠ‚ç‚¹å¯¹ä¹‹é—´çš„æœ€çŸ­è·¯å¾„ï¼Œéœ€è¦è¿è¡Œ **$V$** æ¬¡ Dijkstraï¼Œæ€»å¤æ‚åº¦å˜ä¸º **$O(V(V+E)\log V)$**ã€‚

* *æ›¿ä»£æ–¹æ¡ˆï¼š* æ‰€æœ‰å¯¹æœ€çŸ­è·¯å¾„é—®é¢˜é€šå¸¸ä½¿ç”¨ **Floyd-Warshall ç®—æ³•** (**$O(V^3)$**)ã€‚

1. **è®¡ç®—èŒƒå›´å¤§** ï¼šå³ä½¿æ‚¨åªéœ€è¦ä» **$A$** åˆ° **$B$** çš„è·¯å¾„ï¼ŒDijkstra ç®—æ³•åœ¨æœ€åæƒ…å†µä¸‹ä¹Ÿå¯èƒ½éœ€è¦æ¢ç´¢å›¾ä¸­çš„å¤§éƒ¨åˆ†åŒºåŸŸï¼Œå› ä¸ºå®ƒæœ¬è´¨ä¸Šæ˜¯è®¡ç®—ä» **$A$** åˆ°**æ‰€æœ‰**ç‚¹çš„æœ€çŸ­è·¯å¾„ã€‚

* *æ›¿ä»£æ–¹æ¡ˆï¼š* å¸¦æœ‰å¯å‘å¼æœç´¢çš„  **A* ç®—æ³•** ï¼Œåœ¨çŸ¥é“ç›®æ ‡ä½ç½®çš„æƒ…å†µä¸‹ï¼Œå¯ä»¥æ›´å¿«åœ°æ”¶æ•›åˆ°ç»ˆç‚¹ã€‚

### A*

#### ç®—æ³•åŸç†

A* (A-star) ç®—æ³•æ˜¯å›¾æœç´¢ç®—æ³•ä¸­æœ€è‘—åå’Œæœ€æˆåŠŸçš„ç®—æ³•ä¹‹ä¸€ã€‚å®ƒé€šå¸¸ç”¨äº**å¯»è·¯**å’Œ **å›¾éå†** ï¼Œå°¤å…¶æ˜¯åœ¨æœ‰æ˜ç¡®ç›®æ ‡çš„æƒ…å†µä¸‹ï¼Œå®ƒæ¯” Dijkstra ç®—æ³•æ›´é«˜æ•ˆã€‚

#### æ ¸å¿ƒæ€æƒ³ï¼šè¯„ä¼°å‡½æ•° **$f(n)$**

A* ç®—æ³•é€šè¿‡å¼•å…¥ä¸€ä¸ª**å¯å‘å¼å‡½æ•°ï¼ˆHeuristic Functionï¼‰**æ¥æŒ‡å¯¼æœç´¢æ–¹å‘ï¼Œä½¿å…¶ä¼˜å…ˆæœç´¢é è¿‘ç›®æ ‡çš„èŠ‚ç‚¹ï¼Œä»è€Œé¿å…åƒ Dijkstra é‚£æ ·â€œç›²ç›®â€åœ°å‘å„ä¸ªæ–¹å‘æ‰©å±•ã€‚

A* ç®—æ³•åœ¨é€‰æ‹©ä¸‹ä¸€ä¸ªè¦æ¢ç´¢çš„èŠ‚ç‚¹ **$n$** æ—¶ï¼Œä¾æ®ä¸€ä¸ª**è¯„ä¼°å‡½æ•° **$f(n)$**** çš„æœ€å°å€¼ï¼š

$$
f(n) = g(n) + h(n)
$$

| **ç»„æˆéƒ¨åˆ†** | **å«ä¹‰**                        | **è§£é‡Š (ä¸ Dijkstra åŒºåˆ«)**                                                                                                           |
| ------------------ | ------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------- |
| **$g(n)$** | **å®é™…æˆæœ¬ (Actual Cost)**      | ä»**èµ·ç‚¹**åˆ°å½“å‰èŠ‚ç‚¹**$n$**çš„ **å®é™…æœ€çŸ­è·¯å¾„æˆæœ¬** ã€‚**è¿™éƒ¨åˆ†ä¸ Dijkstra ç®—æ³•çš„**$\text{dist}[n]$**å®Œå…¨ç›¸åŒã€‚** |
| **$h(n)$** | **å¯å‘å¼æˆæœ¬ (Heuristic Cost)** | ä»å½“å‰èŠ‚ç‚¹**$n$**åˆ°**ç›®æ ‡ç‚¹**çš„ **ä¼°è®¡æˆæœ¬** ã€‚è¿™ä¸ªä¼°è®¡å€¼å¿…é¡»æ˜¯ **å¯æ¥å—çš„ (Admissible)** ã€‚                            |
| **$f(n)$** | **æ€»è¯„ä¼°æˆæœ¬ (Total Cost)**     | ä»**èµ·ç‚¹**ç»è¿‡**$n$**åˆ°è¾¾**ç›®æ ‡ç‚¹**çš„ **æ€»ä¼°è®¡æˆæœ¬** ã€‚ç®—æ³•æ€»æ˜¯ä¼˜å…ˆé€‰æ‹©**$f(n)$**æœ€å°çš„èŠ‚ç‚¹ã€‚                   |

#### å¸¸è§å¯å‘å¼å‡½æ•°

åœ¨ç½‘æ ¼åœ°å›¾ï¼ˆå¦‚æ¸¸æˆæˆ–æœºå™¨äººè·¯å¾„è§„åˆ’ï¼‰ä¸­ï¼Œæœ€å¸¸ç”¨çš„å¯å‘å¼å‡½æ•°æ˜¯ï¼š

* æ›¼å“ˆé¡¿è·ç¦» (Manhattan Distance)ï¼šç”¨äºå…è®¸å››ä¸ªæ–¹å‘ç§»åŠ¨çš„ç½‘æ ¼å›¾ã€‚
  $$
  h(n) = |x_n - x_{\text{ç›®æ ‡}}| + |y_n - y_{\text{ç›®æ ‡}}|
  $$
* æ¬§å‡ é‡Œå¾—è·ç¦» (Euclidean Distance)ï¼šç”¨äºå…è®¸å…«ä¸ªæ–¹å‘ç§»åŠ¨çš„ç½‘æ ¼å›¾ã€‚
  $$
  h(n) = \sqrt{(x_n - x_{\text{ç›®æ ‡}})^2 + (y_n - y_{\text{ç›®æ ‡}})^2}
  $$

#### ç®—æ³•æ­¥éª¤æ€»ç»“

A* ç®—æ³•çš„æ­¥éª¤ä¸ Dijkstra éå¸¸ç›¸ä¼¼ï¼Œä¸»è¦åŒºåˆ«åœ¨äºä¼˜å…ˆé˜Ÿåˆ—ä¸­å­˜å‚¨å’Œæ¯”è¾ƒçš„å€¼ï¼š

1. **åˆå§‹åŒ–** ï¼šä½¿ç”¨ä¸¤ä¸ªåˆ—è¡¨/é›†åˆï¼Œ`OpenList`ï¼ˆç›¸å½“äº Dijkstra çš„ä¼˜å…ˆé˜Ÿåˆ—ï¼Œå­˜å‚¨å¾…è®¿é—®èŠ‚ç‚¹ï¼‰å’Œ `ClosedList`ï¼ˆå­˜å‚¨å·²è®¿é—®èŠ‚ç‚¹ï¼‰ã€‚
2. **è®¾ç½®** ï¼š

* **$\text{g\_score}[n]$** å­˜å‚¨ **$g(n)$**ï¼Œåˆå§‹åŒ–èµ·ç‚¹ **$\text{g\_score}[\text{start}] = 0$**ï¼Œå…¶ä»–ä¸º **$\infty$**ã€‚
* **$\text{f\_score}[n]$** å­˜å‚¨ **$f(n)$**ï¼Œåˆå§‹åŒ– **$\text{f\_score}[\text{start}] = h(\text{start})$**ï¼Œå…¶ä»–ä¸º **$\infty$**ã€‚
* å°† **$\langle f(\text{start}), \text{start} \rangle$** å‹å…¥ä¼˜å…ˆé˜Ÿåˆ— (`OpenList`)ã€‚

3. **å¾ªç¯** ï¼šå½“ `OpenList` ä¸ä¸ºç©ºæ—¶ï¼š

* ä» `OpenList` ä¸­å–å‡º **$f(n)$** æœ€å°çš„èŠ‚ç‚¹ **$u$**ã€‚
* å¦‚æœ **$u$** æ˜¯ç›®æ ‡ç‚¹ï¼Œåˆ™åœæ­¢å¹¶é‡å»ºè·¯å¾„ã€‚
* å¯¹äº **$u$** çš„æ¯ä¸ªé‚»å±… **$v$**ï¼š
  * è®¡ç®—é€šè¿‡ **$u$** åˆ°è¾¾ **$v$** çš„æ–° **$g$** å€¼ï¼š**$\text{new\_g} = \text{g\_score}[u] + \text{weight}(u, v)$**ã€‚
  * **æ¾å¼›** ï¼šå¦‚æœ **$\text{new\_g} < \text{g\_score}[v]$**ï¼š
  * æ›´æ–° **$\text{g\_score}[v] = \text{new\_g}$**ã€‚
  * æ›´æ–° **$\text{f\_score}[v] = \text{g\_score}[v] + h(v)$**ã€‚
  * è®°å½•å‰é©± **$\text{parent}[v] = u$**ã€‚
  * å°† **$\langle f(v), v \rangle$** å‹å…¥ `OpenList`ã€‚

#### å¤æ‚åº¦

##### æ—¶é—´å¤æ‚åº¦

$$
\text{æœ€åæ—¶é—´å¤æ‚åº¦} = O((V + E) \log V)
$$

**ç„¶è€Œï¼ŒA* çš„å®é™…æ€§èƒ½ä¼˜åŠ¿ä½“ç°åœ¨å…¶å¹³å‡/æœ€ä½³æ—¶é—´å¤æ‚åº¦ä¸Šï¼š**

* **å¹³å‡è€—æ—¶ï¼š** å½“å¯å‘å¼å‡½æ•° **$h(n)$** ä¼˜ç§€ä¸”å…·æœ‰æŒ‡å¯¼æ€§æ—¶ï¼ŒA* ç®—æ³•åªä¼šæœç´¢åœ°å›¾çš„ä¸€å°éƒ¨åˆ†ï¼ˆé è¿‘ç›®æ ‡ç‚¹çš„åŒºåŸŸï¼‰ï¼Œè€Œä¸æ˜¯åƒ Dijkstra é‚£æ ·å‡åŒ€åœ°å‘å¤–æ‰©å±•ã€‚
  * **æœç´¢èŠ‚ç‚¹æ•° **$V'$**:** å®é™…æ¢ç´¢çš„èŠ‚ç‚¹æ•° **$V'$** è¿œå°äºæ€»èŠ‚ç‚¹æ•° **$V$**ã€‚
  * **å®é™…å¤æ‚åº¦ï¼š** åœ¨è®¸å¤šå®é™…åº”ç”¨ä¸­ï¼ŒA* çš„è¡¨ç°æ›´æ¥è¿‘äº **$O(V' \log V')$**ï¼Œå…¶ä¸­ **$V'$** æ˜¯ç®—æ³•å®é™…éå†çš„èŠ‚ç‚¹æ•°ã€‚
  * **å½“ **$h(n)$** éå¸¸å‡†ç¡®æ—¶ï¼ˆä¾‹å¦‚ **$h(n)$** ç­‰äºå®é™…æœ€çŸ­è·ç¦»ï¼‰ï¼š** A* çš„æœç´¢å¯ä»¥éå¸¸æ¥è¿‘çº¿æ€§æ—¶é—´ **$O(V')$**.

##### ç©ºé—´å¤æ‚åº¦

| **æ•°æ®ç»“æ„**             | **ç©ºé—´å ç”¨**                   | **ä½œç”¨**                                                                                      |
| ------------------------------ | ------------------------------------ | --------------------------------------------------------------------------------------------------- |
| **èŠ‚ç‚¹æ•°ç»„ (`nodes`)** | **$O(V)$**                   | å­˜å‚¨æ‰€æœ‰èŠ‚ç‚¹çš„çŠ¶æ€ï¼ˆ**$g\_score, f\_score, \text{parent}, x, y$**ï¼‰ã€‚è¿™æ˜¯æœ€ä¸»è¦çš„å†…å­˜å ç”¨ã€‚ |
| **ä¼˜å…ˆé˜Ÿåˆ— (`pq`)**    | æœ€å**$O(V)$**æˆ–**$O(E)$** | å­˜å‚¨å¾…æ¢ç´¢çš„èŠ‚ç‚¹ã€‚æœ€åæƒ…å†µä¸‹ä¸è¾¹çš„æ•°é‡**$E$**æˆæ­£æ¯”ï¼Œä½†åœ¨ç¨€ç–ç½‘æ ¼å›¾ä¸­ä¸º**$O(V)$**ã€‚       |
| **è¾“å…¥åœ°å›¾ (`map`)**   | **$O(V)$**                   | å­˜å‚¨ç½‘æ ¼éšœç¢ç‰©ä¿¡æ¯ã€‚                                                                                |

**æ€»ç©ºé—´å¤æ‚åº¦**ä¸ºï¼š

$$
O(V)
$$

#### ä¼˜ç¼ºç‚¹æ€»ç»“

##### âœ… ä¼˜ç‚¹ (Advantages)

1. **æ•ˆç‡æé«˜ï¼ˆå®šå‘æœç´¢ï¼‰** ï¼šè¿™æ˜¯ A* ç›¸è¾ƒäº Dijkstra æœ€å¤§çš„ä¼˜åŠ¿ã€‚é€šè¿‡ä½¿ç”¨å¯å‘å¼å‡½æ•° **$h(n)$**ï¼ŒA* èƒ½å¤Ÿå°†æœç´¢é‡ç‚¹æ”¾åœ¨æ¥è¿‘ç›®æ ‡ç‚¹çš„åŒºåŸŸï¼Œä»è€Œé¿å…æ¢ç´¢å¤§é‡æ— å…³èŠ‚ç‚¹ï¼Œå¤§å¤§èŠ‚çœäº†è®¡ç®—æ—¶é—´ã€‚
2. **ä¿è¯æœ€ä¼˜è§£ï¼ˆå®Œå¤‡æ€§ï¼‰** ï¼šåªè¦ä½¿ç”¨çš„å¯å‘å¼å‡½æ•° **$h(n)$** æ˜¯ **å¯æ¥å—çš„ (Admissible)** ï¼ˆå³æ°¸ä¸å¤¸å¤§å®é™…æˆæœ¬ï¼‰ï¼ŒA* å°±èƒ½ä¿è¯æ‰¾åˆ°æœ€çŸ­è·¯å¾„ã€‚
3. **é€‚åº”æ€§å¼º** ï¼šå¯ä»¥é€šè¿‡è°ƒæ•´å¯å‘å¼å‡½æ•°æ¥å¹³è¡¡æœç´¢é€Ÿåº¦å’Œæœ€ä¼˜æ€§ï¼š

* **æé«˜ **$h(n)$** ç²¾åº¦** ï¼šæœç´¢é€Ÿåº¦æ›´å¿«ï¼Œä½†éœ€ç¡®ä¿ä»æ˜¯å¯æ¥å—çš„ã€‚
* **$h(n) = 0$** ï¼šé€€åŒ–ä¸º Dijkstraï¼Œä¿è¯æœ€ä¼˜ä½†é€Ÿåº¦æ…¢ã€‚

1. **åº”ç”¨å¹¿æ³›** ï¼šå®ƒæ˜¯æ¸¸æˆå¯»è·¯ã€æœºå™¨äººå¯¼èˆªã€ç‰©æµè§„åˆ’ç­‰è®¸å¤šé¢†åŸŸä¸­æœ€å¸¸ç”¨çš„ç®—æ³•ã€‚

##### âŒ ç¼ºç‚¹ (Disadvantages)

1. **å†…å­˜æ¶ˆè€—å¤§** ï¼šA* å¿…é¡»å­˜å‚¨æ‰€æœ‰å·²è®¿é—®èŠ‚ç‚¹çš„ä¿¡æ¯ï¼ˆåœ¨æ‚¨çš„ä»£ç ä¸­æ˜¯æ•´ä¸ª **$R \times C$** çš„ `nodes` æ•°ç»„ï¼‰ï¼Œä»¥ä¾¿è¿›è¡Œæ¾å¼›æ“ä½œå’Œè·¯å¾„é‡å»ºã€‚å¯¹äºéå¸¸å¤§çš„åœ°å›¾æˆ–å›¾ï¼Œå†…å­˜é™åˆ¶å¯èƒ½æ˜¯ä¸€ä¸ªé—®é¢˜ã€‚

* *Dijkstra ä¹Ÿéœ€è¦å­˜å‚¨æ‰€æœ‰èŠ‚ç‚¹çš„ `dist`ï¼Œä½† A* å¯¹å†…å­˜çš„å‹åŠ›é€šå¸¸æ›´å¤§ï¼Œå› ä¸ºå®ƒéœ€è¦å­˜å‚¨æ›´å¤šçš„çŠ¶æ€ä¿¡æ¯ã€‚*

1. **ä¾èµ–å¯å‘å¼å‡½æ•°** ï¼šA* çš„æ•ˆç‡å’Œæ­£ç¡®æ€§**å¼ºçƒˆä¾èµ–**äºå¯å‘å¼å‡½æ•°çš„è´¨é‡ï¼š

* **$h(n)$ ä¸å¯æ¥å—** ï¼šå¦‚æœå¯å‘å¼å‡½æ•°å¤¸å¤§äº†å®é™…æˆæœ¬ï¼ŒA* ç®—æ³•å¯èƒ½æ— æ³•ä¿è¯æ‰¾åˆ°æœ€çŸ­è·¯å¾„ã€‚
* **$h(n)$ å¤ªå°** ï¼šå¦‚æœå¯å‘å¼å‡½æ•°å¤ªå°ï¼ˆæ¥è¿‘ 0ï¼‰ï¼ŒA* çš„æ€§èƒ½ä¼šæ¥è¿‘ Dijkstraï¼Œå¤±å»å®šå‘æœç´¢çš„ä¼˜åŠ¿ã€‚

1. **æ— æ³•å¤„ç†è´Ÿæƒè¾¹** ï¼šä¸ Dijkstra ç®—æ³•ä¸€æ ·ï¼ŒA* ç®—æ³•çš„è´ªå¿ƒç­–ç•¥ä¾èµ–äºè¾¹çš„éè´Ÿæƒã€‚å¦‚æœå›¾ä¸­æœ‰è´Ÿæƒè¾¹ï¼ŒA* ç®—æ³•ä¼šå¤±æ•ˆã€‚

### Bæ ·æ¡æ›²çº¿æ’å€¼ä¼˜åŒ–

Bæ ·æ¡è½¨è¿¹çš„ç”Ÿæˆåˆ†ä¸ºä¸¤æ­¥ï¼š

1. **å…ˆç”Ÿæˆæ§åˆ¶ç‚¹ï¼ˆControl Pointsï¼‰**
   é€šè¿‡ã€Œå¸¦è¾¹ç•Œé€Ÿåº¦/åŠ é€Ÿåº¦çº¦æŸçš„æœ€å°äºŒä¹˜æ‹Ÿåˆã€æŠŠã€Œå¯†é›†é‡‡æ ·ç‚¹äº‘ + èµ·ç‚¹/ç»ˆç‚¹ vel/accã€ç›´æ¥è§£ç®—å‡ºä¸€ç»„æ§åˆ¶ç‚¹ Pâ‚€, Pâ‚, â€¦, Pâ‚™
   ï¼ˆè¿™ä¸€æ­¥ç”¨çš„å°±æ˜¯ä½ è¯´çš„ parameterizeToBsplineï¼ŒçŸ©é˜µ A æ˜¯ K+4 è¡Œï¼Œè§£çš„æ˜¯ AÂ·P = bï¼‰
2. **å†ç”¨æ§åˆ¶ç‚¹ + Bæ ·æ¡åŸºå‡½æ•°åˆæˆè¿ç»­è½¨è¿¹**
   ä»»æ„æ—¶åˆ»çš„ä½ç½® = âˆ‘ Páµ¢ Â· Náµ¢,â‚–(u)
   å…¶ä¸­ï¼š

   * Náµ¢,â‚–(u) æ˜¯ç¬¬ i ä¸ª k é˜¶ï¼ˆè¿™é‡Œ k=6ï¼‰Bæ ·æ¡åŸºå‡½æ•°ï¼ˆCoxâ€“de Boor é€’å½’å®šä¹‰ï¼‰
   * u æ˜¯å½’ä¸€åŒ–çš„å…¨å±€å‚æ•°ï¼ˆåœ¨ Fast-Planner é‡Œç”¨ã€Œç´¯è®¡æ—¶é—´ / dtã€æ˜ å°„æˆæ•´æ•°+å°æ•°å½¢å¼ï¼‰
   * ä»»ä¸€æ—¶åˆ»åªæœ‰æœ€å¤š 6 ä¸ªåŸºå‡½æ•°éé›¶ï¼ˆå±€éƒ¨æ”¯æ’‘æ€§ï¼‰

| åºå· | é¢è¯•å®˜é—®é¢˜                                          | æ ‡å‡†ç­”æ¡ˆï¼ˆç›´æ¥èƒŒï¼‰                                                                                           |
| ---- | --------------------------------------------------- | ------------------------------------------------------------------------------------------------------------ |
| 1    | ä¸ºä»€ä¹ˆåˆå§‹è½¨è¿¹è¦ç”¨5æ¬¡å¤šé¡¹å¼ï¼Ÿ                       | å› ä¸ºè¦æœ€å°åŒ–jerkå¹³æ–¹ç§¯åˆ†ï¼ŒåŒæ—¶æ»¡è¶³ä½ç½®ã€é€Ÿåº¦ã€åŠ é€Ÿåº¦è¿ç»­ï¼ˆCÂ²è¿ç»­ï¼‰ï¼Œæ•°å­¦è¯æ˜æœ€ä¼˜è§£æ˜¯åˆ†æ®µ5æ¬¡å¤šé¡¹å¼ã€‚         |
| 2    | 5æ¬¡Bæ ·æ¡çš„é˜¶æ•°æ˜¯å¤šå°‘ï¼ŸåŸºå‡½æ•°æ˜¯ä»€ä¹ˆï¼Ÿ                | æ¬¡æ•°5ï¼Œé˜¶æ•° k=6ï¼ŒåŸºå‡½æ•°æ˜¯æ ‡å‡†çš„ Coxâ€“de Boor é€’å½’å®šä¹‰çš„6é˜¶Bæ ·æ¡åŸºå‡½æ•°ï¼Œå‡åŒ€èŠ‚ç‚¹ + é¦–å°¾ clampedã€‚             |
| 3    | ä¸ºä»€ä¹ˆæœ€ç»ˆè½¨è¿¹è¦æ¢æˆBæ ·æ¡ï¼Ÿ                         | å› ä¸ºBæ ·æ¡æ§åˆ¶ç‚¹å…·æœ‰å±€éƒ¨æ”¯æ’‘æ€§ï¼Œä¼˜åŒ–æ—¶é›…å¯æ¯”ç¨€ç–ï¼Œè®¡ç®—é‡å°ï¼Œé€‚åˆå®æ—¶æ¢¯åº¦ä¼˜åŒ–ï¼›è€Œä¸”5æ¬¡Bæ ·æ¡å¤©ç„¶ jerk è¿ç»­ã€‚    |
| 4    | 5æ¬¡å¤šé¡¹å¼å’Œ5æ¬¡Bæ ·æ¡è°æ›´å¹³æ»‘ï¼Ÿ                       | å®Œå…¨ä¸€æ ·å¹³æ»‘ï¼ˆjerkéƒ½è¿ç»­ï¼‰ï¼Œåªæ˜¯å‚æ•°åŒ–ä¸åŒï¼Œè¡¨è¾¾èƒ½åŠ›ç­‰ä»·ã€‚                                                   |
| 5    | Bæ ·æ¡ä¼˜åŒ–å™¨é‡Œéƒ½ä¼˜åŒ–äº†å“ªäº›costï¼Ÿ                     | å¹³æ»‘é¡¹ï¼ˆjerkï¼‰ã€éšœç¢ç‰©è·ç¦»ã€å¤šæ— äººæœºè·ç¦»ã€å¯è¡Œæ€§ï¼ˆvel/accé™ï¼‰ã€æœ€å°æ—¶é—´ï¼ˆå¯é€‰ï¼‰ã€‚                            |
| 6    | å¦‚ä½•ä¿è¯èµ·ç‚¹çŠ¶æ€ç²¾ç¡®åŒ¹é…ï¼Ÿ                          | ä¼˜åŒ–æ—¶æŠŠå‰6ä¸ªï¼ˆk=6ï¼‰æ§åˆ¶ç‚¹å›ºå®šï¼Œæˆ–è€…åŠ ç¡¬çº¦æŸï¼›æ‹Ÿåˆæ—¶ä¹Ÿå¼ºåˆ¶è¾¹ç•Œé€Ÿåº¦åŠ é€Ÿåº¦ã€‚                                   |
| 7    | ä¸ºä»€ä¹ˆé‡‡æ ·ç‚¹è¦é‚£ä¹ˆå¯†ï¼Ÿ                              | é‡‡æ ·ç‚¹è¶Šå¯†ï¼Œæ‹Ÿåˆåçš„Bæ ·æ¡è¶Šæ¥è¿‘åŸå§‹æœ€å°jerkè½¨è¿¹ï¼Œä¼˜åŒ–æ›´å®¹æ˜“æ”¶æ•›ã€‚                                            |
| 8    | èŠ‚ç‚¹æ˜¯å‡åŒ€çš„è¿˜æ˜¯éå‡åŒ€çš„ï¼Ÿ                          | æ¢ç´¢æ¨¡å¼ä¸‹æ˜¯å‡åŒ€èŠ‚ç‚¹ï¼ˆuniformï¼‰ï¼Œé‡è§„åˆ’æ—¶ä¹Ÿä¼šå¼ºè¡Œç”¨å‡åŒ€ï¼Œè®¡ç®—æ›´å¿«ã€‚                                          |
| 9    | ä¸ºä»€ä¹ˆä¸ç›´æ¥ä¼˜åŒ–å¤šé¡¹å¼ç³»æ•°ï¼Ÿ                        | å¤šé¡¹å¼ç³»æ•°æ˜¯å…¨å±€è€¦åˆçš„ï¼Œæ”¹ä¸€ä¸ªç³»æ•°å½±å“æ•´æ¡è½¨è¿¹ï¼Œä¼˜åŒ–é›…å¯æ¯”ç¨ å¯†ï¼Œè®¡ç®—é‡å¤§ä¸”å®¹æ˜“éœ‡è¡ã€‚                         |
| 10   | Bæ ·æ¡çš„å‡¸åŒ…æ€§è´¨æœ‰ä»€ä¹ˆç”¨ï¼Ÿ                           | å¯ä»¥å¿«é€Ÿåˆ¤æ–­æ•´æ®µè½¨è¿¹æ˜¯å¦å¯èƒ½ç¢°æ’ï¼ˆå…ˆæ£€æŸ¥æ§åˆ¶ç‚¹å¤šé¢ä½“ï¼‰ï¼ŒåŠ é€Ÿç²—ç¢°æ’æ£€æµ‹ã€‚                                     |
| 11   | jerkè¿ç»­æœ‰ä»€ä¹ˆç‰©ç†æ„ä¹‰ï¼Ÿ                            | åŠ åŠ é€Ÿåº¦è¿ç»­ï¼Œæ‰§è¡Œæ—¶åŠ›çŸ©å˜åŒ–å¹³æ»‘ï¼ŒçœŸå®æ— äººæœºä¸ä¼šæŠ–åŠ¨ã€‚                                                       |
| 12   | ä¸ºä»€ä¹ˆdegree=5æ˜¯ç›®å‰æœ€å¥½çš„æŠ˜ä¸­ï¼Ÿ                    | degree=3ï¼šåªé€Ÿåº¦è¿ç»­ï¼Œjerkè·³å˜ï¼›degree=7ï¼šæ”¯æ’‘åŒºé—´å¤ªé•¿ï¼Œä¼˜åŒ–æ…¢ï¼›5æ¬¡æ­£å¥½jerkè¿ç»­ä¸”æ”¯æ’‘åŒºé—´çŸ­ã€‚                |
| 13   | parameterizeToBsplineé‚£æ®µ[1,26,66,26,1]/120æ˜¯ä»€ä¹ˆï¼Ÿ | 5æ¬¡å‡åŒ€Bæ ·æ¡åœ¨é‡‡æ ·ç‚¹æ­£ä¸­é—´æ—¶åˆ»ï¼Œ6ä¸ªéé›¶åŸºå‡½æ•°çš„å€¼ï¼ˆè§£æè¡¨è¾¾å¼ï¼‰ï¼Œç”¨æ¥å¿«é€Ÿæ„é€ æœ€å°äºŒä¹˜çŸ©é˜µã€‚                  |
| 14   | å¦‚æœè·¯å¾„ç‚¹å¾ˆå°‘ï¼ˆæ¯”å¦‚åªæœ‰2ä¸ªç‚¹ï¼‰ä¼šæ€æ ·ï¼Ÿ             | æœ€å°jerkç›´æ¥é€€åŒ–æˆå•æ®µ5æ¬¡å¤šé¡¹å¼ï¼ŒBæ ·æ¡æ§åˆ¶ç‚¹ä¹Ÿå¾ˆå°‘ï¼Œä½†ä»èƒ½æ­£å¸¸å·¥ä½œã€‚                                         |
| 15   | è¿™å¥—æ–¹æ³•æœ€å¤§çš„å±€é™æ€§æ˜¯ä»€ä¹ˆï¼Ÿ                        | å¯¹éå¸¸å¤æ‚çš„ç‹­çª„ç¯å¢ƒï¼Œåˆå§‹æœ€å°jerkå¯èƒ½ç›´æ¥æ’å¢™ï¼Œå¯¼è‡´ä¼˜åŒ–æ— æ¢¯åº¦é€ƒç¦»ï¼ˆéœ€è¦å‰ç«¯è·¯å¾„æœç´¢æ›´å¼ºï¼Œæˆ–è€…åŠ éšæœºé‡å¯ï¼‰ã€‚ |

### PID+puresuitæ§åˆ¶

#### ç®—æ³•æ­¥éª¤è¯¦è§£

1. ç¡®å®šå‰è§†è·ç¦»

   $L_d$ æ˜¯ Pure Pursuit ç®—æ³•çš„å…³é”®è°ƒå‚é¡¹ï¼Œå®ƒé€šå¸¸ä¸è½¦é€Ÿ $v$ ç›¸å…³è”ï¼Œä»¥ç¡®ä¿åœ¨ä¸åŒé€Ÿåº¦ä¸‹æœ‰åˆé€‚çš„è·Ÿè¸ªæ€§èƒ½å’Œç¨³å®šæ€§ï¼š

   $$
   L_d = k \cdot v + L_{d_{min}}
   $$

   ğŸ’¡ **è°ƒå‚å½±å“ï¼š**

   - $L_d$ å¤ªå°ï¼š è½¦è¾†ååº”çµæ•ï¼Œä½†å®¹æ˜“å‡ºç°éœ‡è¡å’Œä¸ç¨³å®šçš„è·Ÿè¸ªã€‚
   - $L_d$ å¤ªå¤§ï¼š è·Ÿè¸ªè¿‡äºå¹³æ»‘ï¼Œä½†ä¼šæ¬ è°ƒå¯¼è‡´åœ¨å¼¯é“ä¸­åˆ‡è§’è¿‡å¤šï¼Œè·Ÿè¸ªåå·®å¤§ã€‚
2. å¯»æ‰¾å‰è§†ç‚¹

   - ä»¥å½“å‰ä½ç½® $P_{current}$ ä¸ºåœ†å¿ƒï¼Œä»¥ $L_d$ ä¸ºåŠå¾„ï¼Œåœ¨å‚è€ƒè½¨è¿¹ $P_{ref}$ ä¸Šç”»ä¸€ä¸ªåœ†ã€‚
   - æ‰¾åˆ°è¿™ä¸ªåœ†ä¸è½¨è¿¹çš„äº¤ç‚¹ã€‚
   - å¦‚æœæœ‰å¤šä¸ªäº¤ç‚¹ï¼Œé€‰æ‹©æœ€è¿œï¼ˆå³æœ€æ¥è¿‘å‰è¿›æ–¹å‘ï¼‰çš„é‚£ä¸ªäº¤ç‚¹ä½œä¸ºå‰è§†ç‚¹ $P_{target}$ã€‚
3. è®¡ç®—è½¬å‘è§’
   ![img](./../../img/puresuit.png)

   | å›¾ä¸­ç¬¦å·    | å«ä¹‰                                                     | å¯¹åº”æ¨å¯¼ä¸­çš„è§’è‰²                 |
   | ----------- | -------------------------------------------------------- | -------------------------------- |
   | $A$       | è½¦è¾†çš„æ§åˆ¶å‚è€ƒç‚¹ï¼ˆé€šå¸¸æ˜¯åè½´ä¸­å¿ƒï¼‰ã€‚                     | $P_{current}$ (å½“å‰ä½ç½®)       |
   | $C$       | è½¨è¿¹ä¸Šçš„å‰è§†ç›®æ ‡ç‚¹ã€‚                                     | $P_{target}$ (å‰è§†ç‚¹)          |
   | $l_d$     | $A$ åˆ° $C$ çš„ç›´çº¿è·ç¦»ï¼ˆå›¾ä¸­çš„ $l_d$ï¼‰ã€‚            | $L_d$ (å‰è§†è·ç¦»)               |
   | $L$       | è½¦è¾†çš„è½´è·ï¼ˆ$A$ åˆ°å‰è½´ $B$ çš„è·ç¦»ï¼‰ã€‚                | $L$ (è½´è·)                     |
   | $\delta$  | å‰è½®çš„è½¬å‘è§’ã€‚                                           | $\delta$ (è½¬å‘è§’)              |
   | $\alpha$  | è½¦è¾†å½“å‰èˆªå‘ï¼ˆ$A$ å¤„çš„çº¢çº¿ï¼‰ä¸ $AC$ è¿çº¿ä¹‹é—´çš„å¤¹è§’ã€‚ | $\alpha$ (ç›¸å¯¹è§’åº¦/æ¨ªå‘åå·®è§’) |
   | $R$       | è½¦è¾†æ²¿ç€åœ†å¼§$AC$ è¿åŠ¨çš„è½¬å¼¯åŠå¾„ã€‚                      | $R$ (è½¬å¼¯åŠå¾„)                 |
   | $O$       | ç†æƒ³åœ†å¼§$AC$ çš„åœ†å¿ƒã€‚                                  | $C$ (åœ†å¿ƒ)                     |
   | $2\alpha$ | åœ†å¿ƒ$O$ å¯¹åº”çš„åœ†å¿ƒè§’ã€‚                                 | $2\alpha$ (åœ†å¿ƒè§’)             |

   ##### ç¬¬ä¸€æ­¥ï¼šæ ¹æ®å‡ ä½•å…³ç³»æ±‚è§£è½¬å¼¯åŠå¾„ $R$

   æˆ‘ä»¬çŸ¥é“ï¼š


   $$
   \sin\left(\frac{\text{åœ†å¿ƒè§’}}{2}\right) = \frac{\text{å¼¦é•¿}/2}{\text{åŠå¾„}}
   $$

   å¯¹äºæˆ‘ä»¬çš„æƒ…å†µï¼š

   $$
   \sin\left(\frac{2\alpha}{2}\right) = \frac{l_d / 2}{R}
   $$

   ç®€åŒ–åå¾—åˆ°ï¼š

   $$
   \sin(\alpha) = \frac{l_d}{2R}
   $$

   è§£å‡ºè½¬å¼¯åŠå¾„ $R$ï¼š

   $$
   R = \frac{l_d}{2 \sin(\alpha)}
   $$

   ##### ç¬¬äºŒæ­¥ï¼šåº”ç”¨é˜¿å…‹æ›¼è½¬å‘æ¨¡å‹æ±‚è½¬å‘è§’ $\delta$

   è½¦è¾†çš„è¿åŠ¨å­¦æ¨¡å‹ï¼ˆé˜¿å…‹æ›¼è½¬å‘æ¨¡å‹ï¼‰æè¿°äº†åœ¨ç»™å®šè½¬å¼¯åŠå¾„ $R$ å’Œè½¦è¾†è½´è· $L$ çš„æƒ…å†µä¸‹ï¼Œå‰è½®éœ€è¦è½¬åŠ¨å¤šå°‘è§’åº¦ $\delta$ï¼š

   $$
   \tan(\delta) = \frac{L}{R}
   $$

   > ğŸ’¡ **è¯´æ˜**ï¼šè¿™ä¸ªå…¬å¼æ¥æºäºå‰è½®è½´çº¿ã€åè½®è½´çº¿å’Œè½¬å¼¯åŠå¾„ $R$ å¿…é¡»äº¤äºåœ†å¿ƒ $O$ çš„å‡ ä½•çº¦æŸã€‚
   >

   ##### ç¬¬ä¸‰æ­¥ï¼šä»£å…¥æ±‚å¾—æœ€ç»ˆå…¬å¼

   å°†ç¬¬ä¸€æ­¥ä¸­æ¨å¯¼å‡ºçš„ $R$ çš„è¡¨è¾¾å¼ä»£å…¥é˜¿å…‹æ›¼è½¬å‘æ¨¡å‹å…¬å¼ä¸­ï¼š

   $$
   \tan(\delta) = \frac{L}{\left(\frac{l_d}{2 \sin(\alpha)}\right)}
   $$

   æ•´ç†å…¬å¼ï¼ˆå°†åˆ†æ¯çš„å€’æ•°ä¹˜ä¸Šå»ï¼‰ï¼š

   $$
   \tan(\delta) = \frac{2 L \sin(\alpha)}{l_d}
   $$

   æœ€åï¼Œé€šè¿‡å–åæ­£åˆ‡å‡½æ•°å¾—åˆ°æ‰€éœ€çš„å‰è½®è½¬å‘è§’ $\delta$ï¼š

   $$
   \delta = \arctan\left(\frac{2 L \sin(\alpha)}{l_d}\right)
   $$

   #### ä»£ç ä¸­æµç¨‹ä¸ä¼˜åŒ–

   ##### ç›®æ ‡ç‚¹æ’å€¼

   {% highlight cpp %}
   if (dist > path_point_threshold_)
   {
      if (dist > 0.5)
      {
         int num_interpoints = static_cast<int>(dist / path_point_threshold_);
         for (int i = 1; i <= num_interpoints; ++i)
         {
            geometry_msgs::Point interp_point;
            interp_point.x = last_point.x + (dx / (num_interpoints + 1)) * i;
            interp_point.y = last_point.y + (dy / (num_interpoints + 1)) * i;
            interp_point.z = last_point.z + (new_point.z - last_point.z) / (num_interpoints + 1) * i;
            path_.push_back(interp_point);
         }
      }
      else
      {
         path_.push_back(new_point);
      }
      ROS_INFO("[%s] Added new path point: x=%.3f, y=%.3f, z=%.3f, path size=%zu", car_id_.c_str(), new_point.x, new_point.y, new_point.z, path_.size());
   }
   {% endhighlight %}

   > ğŸ’¡ **è¯´æ˜**ï¼šå¦‚æœå½“å‰ç‚¹ä¸è·¯å¾„æœ€åä¸€ä¸ªç‚¹çš„è·ç¦»è¶…è¿‡ 0.5mï¼Œåˆ™è¿›è¡Œæ’å€¼ï¼›å¦‚æœåœ¨ 0.05 åˆ° 0.5m ä¹‹é—´åˆ™ç›´æ¥åŠ å…¥å½“å‰ç‚¹ã€‚

##### æ§åˆ¶é€»è¾‘
   1. åŠ¨æ€å‰è§†è·ç¦»è®¡ç®—
      {% highlight cpp %}
      double current_linear_speed = twist.linear.x;
      double dynamic_lookahead_distance = base_lookahead_distance_ + lookahead_speed_factor_ * fabs(current_linear_speed);
      dynamic_lookahead_distance = std::min(1.5, std::max(0.4, dynamic_lookahead_distance));
      {% endhighlight %}
  
   2. æŸ¥æ‰¾è·ç¦»å½“å‰ä½ç½®æœ€è¿‘çš„è·¯å¾„ç‚¹
      {% highlight cpp %}
      for (size_t i = 0; i < path_.size(); ++i)
      {
         double dist = hypot(path_[i].x - current_pose_.position.x, path_[i].y - current_pose_.position.y);
         if (dist < min_dist_to_car)
         {
            min_dist_to_car = dist;
            closest_point_idx = i;
         }
      }
      {% endhighlight %}

   3. è·¯å¾„ç‚¹æ¸…ç†
      - æ ¹æ®æ­¥éª¤äºŒä¸­æŸ¥æ‰¾çš„æœ€è¿‘çš„è·¯å¾„ç‚¹ï¼Œæ¸…ç†æ‰å·²ç»èµ°è¿‡çš„è·¯å¾„ç‚¹ï¼Œç›´åˆ°è·ç¦»å½“å‰ä½ç½®æœ€è¿‘çš„è·¯å¾„ç‚¹çš„å‰ä¸€ä¸ªç‚¹
      - é‡ç½®closest_point_idx=1

   4. å‰è§†ç‚¹æŸ¥æ‰¾
      - è®¡ç®—è·¯å¾„ç‚¹ç›¸å¯¹äºå½“å‰å°è½¦ä½å§¿çš„è·ç¦»ä¸è§’åº¦
      - ä¿è¯è·¯å¾„ç‚¹åœ¨å°è½¦çš„å‰æ–¹
      - è·ç¦»å¤§äºç­‰äºå‰è§†è·ç¦»çš„ä½œä¸ºå‰è§†ç‚¹
      - å¦‚æœéå†å®Œéƒ½æ²¡æœ‰æ‰¾åˆ°ï¼Œåˆ™ç›´æ¥ç”¨è·¯å¾„çš„æœ€åä¸€ä¸ªç‚¹ä½œä¸ºå‰è§†ç‚¹
  
      {% highlight cpp %}
      for (size_t i = closest_point_idx; i < path_.size(); ++i)
      {
         double dist = hypot(path_[i].x - current_pose_.position.x, path_[i].y - current_pose_.position.y);

         // ä»…æ£€æŸ¥è·¯å¾„ç‚¹æ˜¯å¦åœ¨è½¦ä½“å‰æ–¹
         double angle_to_point = atan2(path_[i].y - current_pose_.position.y, path_[i].x - current_pose_.position.x);
         double angle_error = normalize_angle(angle_to_point - current_yaw_);
         if (fabs(angle_error) > M_PI / 2.0 && i != closest_point_idx)
         {
            continue;
         }

         if (dist >= dynamic_lookahead_distance)
         {
            lookahead_point = path_[i];
            found_lookahead = true;
            break;
         }
      }
      {% endhighlight %}

   5. è§’åº¦æ§åˆ¶
      - é‡‡ç”¨ä¸€é˜¶ä½é€šæ»¤æ³¢
      $$X_{\text{smoothed}, k} = \alpha \cdot X_{\text{smoothed}, k-1} + (1 - \alpha) \cdot X_{\text{current}, k}$$
      è¿™ç§æ»¤æ³¢å™¨çš„æ ¸å¿ƒæ€æƒ³æ˜¯ï¼šå½“å‰çš„å¹³æ»‘å€¼æ˜¯ä¸Šä¸€å‘¨æœŸå¹³æ»‘å€¼å’Œå½“å‰åŸå§‹æµ‹é‡å€¼çš„åŠ æƒå¹³å‡ã€‚
      - è§’åº¦åå·®æ¯”è¾ƒå¤§çš„æ—¶å€™ï¼ŒåŸåœ°æ—‹è½¬
      - åˆ°è¾¾ç›®çš„åœ°äº†å°±è°ƒæ•´å§¿æ€

      {% highlight cpp %}
      smoothed_angle_to_target_ = angle_smoothing_factor_ * smoothed_angle_to_target_ + (1 - angle_smoothing_factor_) * angle_to_target;
      twist.angular.z = std::min(max_angular_speed_, std::max(-max_angular_speed_, kp_angular_ * smoothed_angle_to_target_ * 1.5));
      {% endhighlight %}

   
   
   6. æ­£å¸¸å·¡è¿¹
      - å¼•å…¥è§’åº¦å’Œé€Ÿåº¦å½±å“å› å­
      - å¦‚æœè§’åº¦æ¯”è¾ƒå¤§çš„æ—¶å€™ï¼Œ å¹³æ»‘å‡å°çº¿é€Ÿåº¦

      {% highlight cpp %}
      double angle_factor = std::max(0.1, 1.0 - fabs(smoothed_angle_to_target_) / M_PI);

      double speed_factor = std::min(1.0, std::max(0.0, lookahead_point.z));
      const double close_to_lookahead_threshold = 0.5;
      const double large_angle_threshold = M_PI / 4.0; // 45åº¦

      if (distance_error < close_to_lookahead_threshold && fabs(smoothed_angle_to_target_) > large_angle_threshold)
      {
         // é è¿‘å‰è§†ç‚¹ä¸”è§’åº¦ä»ç„¶å¤§ï¼Œå‡é€Ÿæ—‹è½¬
         twist.linear.x = 0.0;
         twist.angular.z = std::min(max_angular_speed_, std::max(-max_angular_speed_, kp_angular_ * smoothed_angle_to_target_));
      }
      else
      {
         // æ­£å¸¸å‰è¿›å’Œè½¬å‘
         twist.linear.x = std::min(max_linear_speed_ * speed_factor * angle_factor, kp_linear_ * distance_error);
         twist.angular.z = std::min(max_angular_speed_, std::max(-max_angular_speed_, kp_angular_ * smoothed_angle_to_target_));
      }
      {% endhighlight %}



##### PIDæ§åˆ¶

   æ ¹æ®å‰é¢å…¬å¼ï¼š

   $$
   \delta = \arctan\left(\frac{2 L \sin(\alpha)}{l_d}\right)
   $$

   å› ä¸ºåœ¨æ‰¾å‰è§†ç‚¹çš„æ—¶å€™ï¼Œæ§åˆ¶äº†å°è½¦å‰æ–¹90åº¦ä»¥å†…ï¼Œ æ‰€ä»¥è¿™ä¸ª$\alpha$  è§’åº¦ä¸ä¼šå¾ˆå¤§ï¼Œ

   $$
   \omega \approx v \cdot \frac{2 \cdot \alpha}{L_d}
   $$

   ç„¶åçº¿é€Ÿåº¦ä¸å‰è§†è·ç¦»å½“ä½œæ§åˆ¶å‚æ•°çš„ä¸€éƒ¨åˆ†ï¼Œæ‰€ä»¥å…¬å¼ç®€åŒ–ï¼š

   $$
   \omega = K_p \cdot \alpha
   $$

   
   

   

### å››å…ƒæ•°è½¬æ¬§æ‹‰è§’ï¼Œå¦‚ä½•é˜²æ­¢å¥‡å¼‚æ€§ï¼Ÿ å¦‚ä½•é˜²æ­¢ä¸‡å‘é”
