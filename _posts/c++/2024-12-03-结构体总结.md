---
layout:     post

title:      c++ä¹‹ç»“æ„ä½“

date:       2024-12-03

author:     phoenixZ

header-img: img/oip7.jpeg

catalog: true

tags:
    - cpp
---
# æ­£æ–‡

## ä»‹ç»

1. æ¯”æ•°ç»„æ›´åŠ çµæ´»
2. ç›¸æ¯”äºç±»ï¼Œæˆå‘˜å±æ€§éƒ½ä¸ºpublic
3. åˆ›å»ºç»“æ„ä½“åŒ…å«ä¸¤æ­¥ï¼Œé¦–å…ˆå®šä¹‰ç»“æ„æè¿°ï¼Œç„¶åæŒ‰ç…§æè¿°åˆ›å»ºç»“æ„å˜é‡

## ç»“æ„åˆå§‹åŒ–

1. `struct Person { char *name; int age; float score; }p1;`
2. `Person p2 = {"james", 18, 92.2};`
3. æŒ‡é’ˆçš„å½¢å¼ `Person *p3 = new (Person);`

## ç»“æ„å±æ€§

1. å¯ä»¥å°†ç»“æ„ä½œä¸ºå‚æ•°ä¼ é€’ç»™å‡½æ•°
2. å¯ä»¥åˆ©ç”¨å‡½æ•°è¿”å›ç»“æ„
3. å¯ä»¥å°†ç»“æ„ä½“èµ‹å€¼ç»™ç›¸åŒç±»å‹çš„ç»“æ„ ï¼Œ åˆ©ç”¨=å·

{% highlight cpp %}
void Print(Person p)
{
    cout << "å§“åï¼š" << p.name << " "
         << "å¹´é¾„: " << p.age  << " "
         << "å¾—åˆ†: " << p.score << " "
         << endl;
}
{% endhighlight %}

## ç»“æ„æ•°ç»„

{% highlight cpp %}
Person p4[100];
p4[10] = {"kobe",19, 99.1};
{% endhighlight %}

# ğŸš€ è¸©å‘è®°å½•

* åœ¨ç±»ä¸­åˆ›å»ºäº†ç»“æ„ä½“ï¼š

{% highlight cpp %}
  struct MsdkCtrl
  {
      int8_t fusionModule;
      int8_t fusionCommand;
  } msdk_ctrl;
{% endhighlight %}

* èµ‹å€¼

  {% highlight cpp %}

  msdk_ctrl.fusionModule  = recvBuffer[16];
  msdk_ctrl.fusionCommand = recvBuffer[17];
  {% endhighlight %}
* é—®é¢˜å‡ºç°

{% highlight cpp %}
  void DjiFsm::taskAllocate()
  {
      ros::Rate rate(10);

    while (ros::ok())
      {
          switch (mc->msdk_ctrl.fusionModule)
          {

    case DOUBLE_VISION:  // åŒå…‰ä»»åŠ¡
              msdk_stat_.data = (mc->msdk_ctrl.fusionCommand == TASK_START) ? START_DOUBLE_VISION : TASK_STOP;
              break;

    case MAP_CONCAT:  // åœ°å›¾æ‹¼æ¥ä»»åŠ¡

    if (mc->msdk_ctrl.fusionCommand == TASK_START)
              {
                  // TODO: è¿™é‡Œå‡è®¾djiStat->dji_.ctrl_dev == 11æ˜¯èˆªè¿¹é£è¡Œæ¨¡å¼ï¼Œéœ€è¦æ ¹æ®å®é™…æµ‹è¯•å€¼è¿›è¡Œä¿®æ”¹
                  if (static_cast`<int>`(djiStat->dji_.ctrl_dev.second) == 11)
                  {
                      msdk_stat_.data = START_MAP_CONCAT;
                  }
                  else
                  {
                      msdk_stat_.data = TASK_PAUSE;
                  }

    last_concat_flag_ = false;
              }
              else
              {
                  msdk_stat_.data = TASK_STOP;

    if (task_id_ == START_MAP_CONCAT)
                  {
                      last_concat_flag_ = true;
                  }
              }

    break;

    default:
              break;
          }

    ROS_INFO_THROTTLE(0.5, "[TASK_ALLOC] current msdk_stat_ is: %d", msdk_stat_.data);

    msdk_state_pub_.publish(msdk_stat_);

    ros::Duration(0.1).sleep();  //åœ100msï¼Œä¿è¯ä¸‹æ¸¸ä»»åŠ¡æ¥æ”¶åˆ°æŒ‡ä»¤åå†è¿”å›ackç»™msdk

    if (mc->connected)
          {
              getBodyAndSend(task_ack_data_, std::bind(&DjiFsm::fsmSendData, this, std::placeholders::_1));
          }

    rate.sleep();
      }
  }
{% endhighlight %}

  ğŸ’¡ åŸå› åˆ†æ

* åœ¨çŠ¶æ€æœºä¸­è°ƒç”¨çš„æ—¶å€™ï¼Œä¼šç›´æ¥è¿›å…¥åˆ°ä»»åŠ¡çš„caseé‡Œé¢ï¼å¼€å§‹ä»¥ä¸º `msdk_ctrl.fusionModule  = recvBuffer[16];ç›´æ¥è¿™æ ·èµ‹å€¼å°±æ˜¯åˆå§‹åŒ–`
* ä»”ç»†åˆ†æåå‘ç°ï¼Œæˆ‘çš„ç»“æ„ä½“çš„å†™æ³•ä¸ºç»“æ„ä½“é»˜è®¤åˆå§‹åŒ–ï¼Œå¹¶ä¸”å†™åœ¨äº†ç±»ä¸­ï¼Œè€Œç±»çš„å®ä¾‹æ˜¯å…¨å±€çš„ï¼Œ å°±å¯¼è‡´æˆ‘çš„ç»“æ„ä½“æ˜¯å…¨å±€çš„ï¼Œè¿™æ ·å°±è¢«é»˜è®¤èµ‹äº†0;

  ğŸ¯  è§£å†³
* åœ¨ç±»æ„é€ æ—¶ï¼Œåˆå§‹åŒ–ç»“æ„ä½“ç»™ä¸€ä¸ªåˆå€¼
